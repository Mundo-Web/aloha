var P=Object.defineProperty;var k=(l,a,r)=>a in l?P(l,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[a]=r;var y=(l,a,r)=>(k(l,typeof a!="symbol"?a+"":a,r),r);import{R as e,r as c}from"./Accordion-B80Lgev0.js";import{c as O}from"./ReactAppend-CCMqV5u4.js";import{C as T}from"./CreateReactScript-CMRUimfa.js";import{I as b}from"./InputFormGroup-DF0_5j3z.js";import{B as U,i as C}from"./Base-OU1LMgxd.js";import"./TippyButton-Ca89MSNc.js";import{m as v}from"./SelectAPIFormGroup-D3e_Xn4g.js";import{S as q}from"./SelectFormGroup-BDnyfbv9.js";import{Q as I}from"./QuillFormGroup-bCC0TPmm.js";import"./MenuItem-YvjQIalw.js";import"./___vite-browser-external_commonjs-proxy-DqvwVSHi.js";const D=({col:l,label:a,eRef:r,placeholder:o,required:n=!1,rows:i=3,value:m})=>e.createElement("div",{className:`form-group ${l} mb-2`},e.createElement("label",{htmlFor:""},a," ",n&&e.createElement("b",{className:"text-danger"},"*")),e.createElement("textarea",{ref:r,className:"form-control",placeholder:o,required:n,rows:i,defaultValue:m,style:{minHeight:i*27,fieldSizing:"content"}}));class N{}y(N,"save",async a=>{try{const{status:r,result:o}=await v.Fetch("/api/profile",{method:"PATCH",body:JSON.stringify(a)});if(!r)throw new Error((o==null?void 0:o.message)||"Ocurrio un error inesperado");return v.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:o.message,type:"success"}),!0}catch(r){return v.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}}),y(N,"saveProfile",async(a,r=!0)=>{try{const{full:o,thumbnail:n,type:i,ok:m}=await File.compress(a,{square:r});if(!m)throw new Error("Ocurrio un error al comprimir la imagen. Intenta con otra.");const f=new FormData;f.append("thumbnail",await File.fromURL(`data:${i};base64,${n}`)),f.append("full",await File.fromURL(`data:${i};base64,${o}`));const u=await fetch("/api/profile",{method:"POST",headers:{"X-Xsrf-Token":decodeURIComponent(v.Cookies.get("XSRF-TOKEN"))},body:f}),E=JSON.parseable(await u.text());if(!u.ok)throw new Error((E==null?void 0:E.message)??"Ocurrio un error inesperado");return v.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:"La imagen de perfil se actualizo correctamente",type:"success"}),E.data}catch(o){return v.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:o.message,type:"danger"}),!1}});class L{constructor(){y(this,"saveCover",async a=>{try{const{full:r,thumbnail:o,type:n,ok:i}=await File.compress(a);if(!i)throw new Error("Ocurrio un error al comprimir la portada. Intenta con otra.");const m=new FormData;m.append("thumbnail",await File.fromURL(`data:${n};base64,${o}`)),m.append("full",await File.fromURL(`data:${n};base64,${r}`));const f=await fetch("/api/cover",{method:"POST",headers:{"X-Xsrf-Token":decodeURIComponent(v.Cookies.get("XSRF-TOKEN"))},body:m}),u=JSON.parseable(await f.text());if(!f.ok)throw new Error((u==null?void 0:u.message)??"Ocurrio un error inesperado");return v.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:"La imagen de portada se actualizo correctamente",type:"success"}),u.data}catch(r){return v.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}})}}const X=new L,j=l=>{const{countries:a}=l,r=c.useRef(),o=c.useRef(),n=c.useRef(),i=c.useRef(),m=c.useRef(),f=c.useRef(),u=c.useRef(),E=c.useRef(),R=c.useRef(),w=c.useRef(),x=c.useRef(),[t,h]=c.useState(l.session),F=async p=>{p.preventDefault();const s={name:r.current.value,lastname:o.current.value,dni:n.current.value,phone:i.current.value,video:m.current.value,title:f.current.value,country:u.current.value,city:E.current.value,address:R.current.value,summary:w.current.value,description:x.current.value};if(!await N.save(s))return;const d=structuredClone(t);d.name=s.name,d.lastname=s.lastname,d.birthdate=s.birthdate,h(d)},$=async p=>{const s=p.target.files[0];if(!s)return;const g=await N.saveProfile(s,!1);if(!g)return;const d=structuredClone(t);d.uuid=g.uuid,h(d)},S=async p=>{const s=p.target.files[0];if(!s)return;const g=await X.saveCover(s);if(!g)return;const d=structuredClone(t);d.uuid=g.uuid,h(d)};return e.createElement(e.Fragment,null,e.createElement("div",{className:"row justify-content-center align-items-center",style:{minHeight:"calc(100vh - 135px)"}},e.createElement("div",{className:"col-xl-8 col-lg-9 col-md-10 col-sm-11 col-xs-12"},e.createElement("form",{className:"card",onSubmit:F},e.createElement("div",{className:"card-header"},e.createElement("h4",{className:"card-title mb-0"},"Perfil")),e.createElement("div",{className:"card-body"},e.createElement("div",{className:"row"},e.createElement("div",{className:"col-sm-4 col-xs-12 position-relative"},e.createElement(C,{content:"Cambiar portada",arrow:!0},e.createElement("label",{htmlFor:"cover",className:"ratio ratio-21x9",style:{cursor:"pointer"}},e.createElement("input",{className:"d-none",type:"file",name:"cover",id:"cover",accept:"image/*",onChange:S}),e.createElement("img",{src:`/api/cover/${t.uuid}?v=${crypto.randomUUID()}`,alt:`Perfil de ${t.name} ${t.lastname}`,style:{width:"100%",objectFit:"cover",objectPosition:"center",borderRadius:"4px"}}))),e.createElement(C,{content:"Cambiar foto de perfil",arrow:!0},e.createElement("label",{htmlFor:"avatar",className:"rounded-circle mx-auto d-block position-relative",style:{cursor:"pointer",width:"max-content",marginTop:"-48px"}},e.createElement("input",{className:"d-none",type:"file",name:"avatar",id:"avatar",accept:"image/*",onChange:$}),e.createElement("img",{className:"avatar-xl rounded-circle bg-white",src:`/api/profile/${t.uuid}?v=${crypto.randomUUID()}`,alt:`Perfil de ${t.name} ${t.lastname}`,style:{objectFit:"cover",objectPosition:"center"}}))),e.createElement("ul",{className:"social-list list-inline mt-3 mb-0"},e.createElement("li",{className:"list-inline-item"},e.createElement("a",{href:"#",className:"social-list-item border-purple text-purple"},e.createElement("i",{className:"fab fa-facebook-f"}))),e.createElement("li",{className:"list-inline-item"},e.createElement("a",{href:"#",className:"social-list-item border-danger text-danger"},e.createElement("i",{className:"mdi mdi-google"}))),e.createElement("li",{className:"list-inline-item"},e.createElement("a",{href:"#",className:"social-list-item border-info text-info"},e.createElement("i",{className:"mdi mdi-twitter"}))),e.createElement("li",{className:"list-inline-item"},e.createElement("a",{href:"#",className:"social-list-item border-secondary text-secondary"},e.createElement("i",{className:"mdi mdi-github"}))))),e.createElement("div",{className:"col-sm-8 col-xs-12"},e.createElement("div",{className:"row"},e.createElement(b,{eRef:r,label:"Nombres",value:t.name,required:!0,col:"col-md-6 col-sm-12"}),e.createElement(b,{eRef:o,label:"Apellidos",value:t.lastname,required:!0,col:"col-md-6 col-sm-12"}),e.createElement(b,{eRef:n,label:"DNI",value:t.dni,required:!0,col:"col-md-6 col-sm-12"}),e.createElement(b,{eRef:i,label:"Telefono",value:t.phone,col:"col-md-6 col-sm-12"}),e.createElement(b,{eRef:m,label:"Video de YouTube",value:`https://youtu.be/${t.video}`}),e.createElement(b,{eRef:f,label:"Titulo",value:t.title,col:"col-md-6 col-sm-12",required:!0}),e.createElement(q,{eRef:u,label:"Pais",value:t.country,col:"col-md-6 col-sm-12",required:!0},a.map((p,s)=>e.createElement("option",{key:`country-${s}`,value:p.id,selected:p.id==t.country},p.name))),e.createElement(b,{eRef:E,label:"Ciudad",value:t.city,col:"col-md-6 col-sm-12",required:!0}),e.createElement(b,{eRef:R,label:"Direccion",value:t.address,col:"col-md-6 col-sm-12"}),e.createElement(D,{eRef:w,label:"Resumen",col:"col-12",value:t.summary}),e.createElement(I,{eRef:x,label:"Descripcion",col:"col-12",value:t.description,height:"240px",required:!0})),e.createElement("div",{className:"text-center"},e.createElement("button",{className:"btn btn-primary btn-block",type:"submit"},e.createElement("i",{className:"fa fa-save"})," Actualizar")),e.createElement("hr",{className:"mt-3 mb-2"}),e.createElement("p",{className:"card-text text-center"},e.createElement("small",{className:"text-muted"},"Ultima actualizacion ",moment(t.updated_at).fromNow())))))))))};T((l,a)=>{O(l).render(e.createElement(U,{...a,title:"Perfil de usuario"},e.createElement(j,{...a})))});
