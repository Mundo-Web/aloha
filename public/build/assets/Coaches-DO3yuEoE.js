var A=Object.defineProperty;var k=(n,t,a)=>t in n?A(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a;var w=(n,t,a)=>(k(n,typeof t!="symbol"?t+"":t,a),a);import{r as l,R as r}from"./Accordion-B80Lgev0.js";import{c as S}from"./ReactAppend-CCMqV5u4.js";import{M as F}from"./Modal-DHkEiqp8.js";import{T as D}from"./Table-BYti2dT1.js";import{I as y}from"./InputFormGroup-DF0_5j3z.js";import{m as C}from"./SelectAPIFormGroup-D3e_Xn4g.js";import{C as T,G as B}from"./CreateReactScript-CMRUimfa.js";import{B as G}from"./BusinessIWorkCard-Bx4M_-JK.js";import{B as I}from"./Base-OU1LMgxd.js";import{J as P}from"./JSEncrypt-D3I3x59l.js";import"./___vite-browser-external_commonjs-proxy-DqvwVSHi.js";import"./MenuItem-YvjQIalw.js";import"./TippyButton-Ca89MSNc.js";const q=({col:n,label:t,eRef:a,required:u=!1,dropdownParent:c,searchAPI:p,searchBy:o,multiple:f=!1,filter:m=null,onChange:d=()=>{},templateResult:b,templateSelection:R})=>(a||(a=l.useRef()),l.useEffect(()=>{$(a.current).select2({dropdownParent:c,minimumInputLength:0,ajax:{url:p,headers:{Accept:"application/json","Content-Type":"application/json","X-Xsrf-Token":decodeURIComponent(C.Cookies.get("XSRF-TOKEN"))},type:"POST",quietMillis:50,data:function({term:i,page:g}){return C.JSON.stringify({sort:[{selector:o,desc:!1}],skip:((g??1)-1)*10,take:10,filter:m?[[o,"contains",i||""],"and",m]:[o,"contains",i||""]})},processResults:function(i,{page:g}){return{results:((i==null?void 0:i.data)??[]).map(E=>{const v=C.JSON.flatten(E);return{id:E.id,text:v[o],data:E}}),pagination:{more:(g??1)*10<i.totalCount}}}},templateResult:b,templateSelection:R})},[c,m]),l.useEffect(()=>{$(a.current).on("change",d)},[m]),r.createElement("div",{className:`form-group ${n} mb-2`},r.createElement("label",{htmlFor:""},t," ",u&&r.createElement("b",{className:"text-danger"},"*")),r.createElement("select",{ref:a,required:u,className:"form-control",style:{width:"100%"},multiple:f}))),j=(n,t,a,u)=>{if($(n).empty(),!!t){if(Array.isArray(t))t.forEach(({[a]:c,[u]:p})=>{const o=document.createElement("option");o.value=c,o.text=p,o.selected=!0,$(n).append(o)});else{const c=document.createElement("option");c.value=t,c.text=a,$(n).append(c),$(n).val(t)}$(n).trigger("change")}};class U extends G{constructor(){super(...arguments);w(this,"path","users")}}const h=new U,M=({})=>{const n=l.useRef(),t=l.useRef(),a=l.useRef(),u=l.useRef(),c=l.useRef(),p=l.useRef(),o=l.useRef(),f=l.useRef(),m=l.useRef(),d=new P;d.setPublicKey(B.PUBLIC_RSA_KEY);const[b,R]=l.useState(!1),i=async e=>{e!=null&&e.id?R(!0):R(!1);const s=await RolesRest.byUser(e==null?void 0:e.id);a.current.value=(e==null?void 0:e.id)||null,u.current.value=(e==null?void 0:e.name)||null,c.current.value=(e==null?void 0:e.lastname)||null,p.current.value=(e==null?void 0:e.email)||null,j(o.current,s,"id","name"),f.current.value=null,m.current.value=null,$(t.current).modal("show")},g=async e=>{e.preventDefault();const s=f.current.value,x=m.current.value,N={id:a.current.value||void 0,name:u.current.value,lastname:c.current.value,email:p.current.value,roles:$(o.current).val(),password:s?d.encrypt(s):void 0,confirm:x?d.encrypt(x):void 0};await h.save(N)&&($(n.current).dxDataGrid("instance").refresh(),$(t.current).modal("hide"))},E=async({id:e,status:s})=>{await h.status({id:e,status:s})&&$(n.current).dxDataGrid("instance").refresh()},v=async e=>{await h.delete(e)&&$(n.current).dxDataGrid("instance").refresh()};return r.createElement(r.Fragment,null,r.createElement(D,{gridRef:n,title:"Usuarios",rest:h,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(n.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"Nuevo registro",onClick:()=>i()}})},columns:[{dataField:"id",caption:"ID",dataType:"number",sortOrder:"asc"},{dataField:"name",caption:"Nombres"},{dataField:"lastname",caption:"Apellidos"},{dataField:"email",caption:"Correo",dataType:"email",cellTemplate:(e,{data:s})=>{e.append(DxBox([r.createElement("img",{className:"avatar-xs rounded-circle",src:`/api/profile/thumbnail/${s.uuid}`,alt:s.name}),r.createElement("p",{className:"mb-0",style:{fontSize:"14px"}},s.email)],!1))}},{dataField:"status",caption:"Estado",dataType:"boolean",cellTemplate:(e,{data:s})=>{switch(s.status){case 1:ReactAppend(e,r.createElement("span",{className:"badge bg-success rounded-pill"},"Activo"));break;case 0:ReactAppend(e,r.createElement("span",{className:"badge bg-danger rounded-pill"},"Inactivo"));break;default:ReactAppend(e,r.createElement("span",{className:"badge bg-dark rounded-pill"},"Eliminado"));break}}},{caption:"Acciones",cellTemplate:(e,{data:s})=>{can("users","root","all","update")&&e.append(DxButton({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>i(s)})),can("projects","root","all","assignUsers")&&e.append(DxButton({className:"btn btn-xs btn-soft-info",title:"Asignar proyectos",icon:"fas fa-folder-plus",onClick:()=>onAssignProjects()})),can("users","root","all","update")&&e.append(DxButton({className:"btn btn-xs btn-light",title:s.status===null?"Restaurar":"Cambiar estado",icon:s.status===1?"fa fa-toggle-on text-success":s.status===0?"fa fa-toggle-off text-danger":"fas fa-trash-restore",onClick:()=>E(s)})),can("users","root","all","delete")&&e.append(DxButton({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash-alt",onClick:()=>v(s.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.createElement(F,{modalRef:t,title:b?"Editar usuario":"Agregar usuario",onSubmit:g},r.createElement("div",{className:"row",id:"users-crud-container"},r.createElement("input",{ref:a,type:"hidden"}),r.createElement(y,{eRef:u,label:"Nombres",col:"col-md-6",required:!0}),r.createElement(y,{eRef:c,label:"Apellidos",col:"col-md-6",required:!0}),r.createElement(y,{eRef:p,label:"Correo",col:"col-12",type:"email",required:!0}),r.createElement(q,{eRef:o,label:"Asignar roles",col:"col-12",dropdownParent:"#users-crud-container",searchAPI:"/api/roles/paginate",searchBy:"name",required:!0,multiple:!0}),r.createElement(PasswordFormGroup,{eRef:f,label:"Contraseña",col:"col-md-6",required:!b}),r.createElement(PasswordFormGroup,{eRef:m,label:"Repetir contraseña",col:"col-md-6",required:!b}))))};T((n,t)=>{S(n).render(r.createElement(I,{...t,title:"Coaches"},r.createElement(M,{...t})))});
