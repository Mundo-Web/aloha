var Y=Object.defineProperty;var U=(m,s,o)=>s in m?Y(m,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):m[s]=o;var P=(m,s,o)=>(U(m,typeof s!="symbol"?s+"":s,o),o);import{j as e}from"./AboutHeader-CpM0iYLI.js";import{B as V}from"./Base-DUtpZS4_.js";import{i as A}from"./tippy-react.esm-CHhA99mn.js";import{r as p}from"./index-B80Lgev0.js";import{c as H}from"./ReactAppend-CBRQCQGz.js";import{S as I}from"./sweetalert2.all-Dh0rZL5X.js";import{m as O}from"./main-B2CtU6ez.js";import{B as G}from"./BasicRest-Dr9i-95X.js";import{M as Q}from"./Modal-B4tqXYU4.js";import{T as Z}from"./Table-CJtAc2bi.js";import{D as M}from"./DxButton-CsjWvhyj.js";import{C as J,G as D}from"./CreateReactScript-DH4VP3S3.js";import{N as y}from"./Number2Currency-e57Tgsuk.js";import{R as q}from"./ReactAppend-C-tNgxIf.js";import{M as K}from"./Modal-MO8_ThPe.js";import{S as X}from"./SelectFormGroup-Du8cJxD5.js";import{r as L}from"./server.browser-D3N0_gce.js";import{I as ee}from"./InputFormGroup-d90I7Tt8.js";/* empty css              */import"./Logout-CPQZ59pt.js";import"./index.esm-Cu-mVv1q.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./WhatsAppModal-CjZ0YwJN.js";import"./index-DO3Aws4m.js";/* empty css               */class te extends G{constructor(){super(...arguments);P(this,"path","admin/sale-statuses");P(this,"bySale",async o=>{try{const{status:a,result:h}=await O.Fetch(`/api/${this.path}/by-sale/${o}`);if(!a)throw new Error((h==null?void 0:h.message)||"Ocurrio un error inesperado");return h.data}catch(a){return O.Notify.add({icon:"/assets/img/favicon.png",title:"Error",body:a.message,type:"danger"}),null}})}}class ne extends G{constructor(){super(...arguments);P(this,"path","admin/sales")}}const z=({name:m,formula:s,details:o})=>{var h,k,t,C,N,w,F,T,j,S,_,f;const a=o==null?void 0:o.filter(l=>!l.user_formula_id||l.user_formula_id==s.id);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("b",{children:"ðŸ§ Tratamiento"}),":"," ",(h=s==null?void 0:s.has_treatment)==null?void 0:h.description]}),e.jsxs("div",{children:[e.jsx("b",{children:"ðŸ‘€ Cuero cabelludo"}),": "," ",(k=s==null?void 0:s.scalp_type)==null?void 0:k.description]}),e.jsxs("div",{children:[e.jsx("b",{children:"âœ… Tipo de cabello"}),":"," ",(t=s==null?void 0:s.hair_type)==null?void 0:t.description]}),(s==null?void 0:s.hair_thickness)&&e.jsxs("div",{children:[e.jsx("b",{children:"ðŸ’ª Grosor del cabello"}),":"," ",(C=s==null?void 0:s.hair_thickness)==null?void 0:C.description]}),e.jsxs("div",{children:[e.jsx("b",{children:"ðŸ’¡ Objetivos"}),":"," ",e.jsx("ul",{className:"mb-0",children:(N=s==null?void 0:s.hair_goals_list)==null?void 0:N.map(l=>e.jsx("li",{children:l.description},l.id))})]}),e.jsxs("div",{children:[e.jsx("b",{children:"ðŸ«™ Fragancia"}),":"," ",(w=s==null?void 0:s.fragrance)==null?void 0:w.name]}),e.jsxs("div",{children:[e.jsx("b",{children:"ðŸŽ¨ Colores:"}),e.jsx("ul",{children:a==null?void 0:a.map((l,g)=>{var u,v;return e.jsxs("li",{children:[l.name,((u=l==null?void 0:l.colors)==null?void 0:u.length)>0&&e.jsxs(e.Fragment,{children:[": ",(v=l==null?void 0:l.colors)==null?void 0:v.map(R=>R.name).join(", ")]})]},g)})})]}),e.jsxs("button",{className:"btn btn-xs btn-dark",type:"button",copy:`*Formula ${m}*

ðŸ§ Tratamiento: ${(F=s==null?void 0:s.has_treatment)==null?void 0:F.description}
ðŸ‘€ Cuero cabelludo: ${(T=s==null?void 0:s.scalp_type)==null?void 0:T.description}
âœ… Tipo de cabello: ${(j=s==null?void 0:s.hair_type)==null?void 0:j.description}
${s!=null&&s.hair_thickness?`ðŸ’ª Grosor del cabello: ${(S=s==null?void 0:s.hair_thickness)==null?void 0:S.description}
`:""}ðŸ’¡ Objetivos:
${(_=s==null?void 0:s.hair_goals_list)==null?void 0:_.map(l=>`- ${l.description}`).join(`
`)}
ðŸ«™ Fragancia: ${(f=s==null?void 0:s.fragrance)==null?void 0:f.name}
ðŸŽ¨ Colores:
${a==null?void 0:a.map(l=>{var g,u;return`- ${l.name}${((g=l==null?void 0:l.colors)==null?void 0:g.length)>0?`: ${(u=l==null?void 0:l.colors)==null?void 0:u.map(v=>v.name).join(", ")}`:""}`}).join(`
`)}`,children:[e.jsx("i",{className:"mdi mdi-content-copy me-1"}),"Copiar"]})]})},se=({modalRef:m,phone_prefixes:s=[]})=>{m||(m=p.useRef());const[o,a]=p.useState([]),[h,k]=p.useState([]),[t,C]=p.useState(""),[N,w]=p.useState(null),F=c=>null,T=(c,i)=>0,j=h.reduce((c,i)=>c+i.price*i.quantity,0),S=F(),_=j*0,f=T(),l=j-_-f,g=()=>{},u=(c,i)=>{},v=(c,i)=>{},R=c=>{},E=async()=>{},n=()=>{},r=c=>{if(!c.id)return c.text;const i=c.element.dataset.code,d=c.element.dataset.flag,x=c.element.dataset.country,b=L(e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-emoji text-center",children:d}),e.jsx("b",{className:"ms-1",children:i}),e.jsx("small",{className:"d-block text-truncate",children:x})]}));return $(b)};return e.jsx(K,{id:"new-sale-modal",modalRef:m,title:"Nueva venta",size:"lg",isStatic:!0,hideFooter:!0,children:e.jsxs("form",{onSubmit:n,children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("h4",{className:"mt-0",children:"InformaciÃ³n del cliente"}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsxs("label",{className:"form-label",children:["Nombres",e.jsx("b",{className:"text-danger ms-1",children:"*"})]}),e.jsx("input",{type:"text",className:"form-control",value:o.name,onChange:c=>a(i=>({...i,name:c.target.value})),required:!0})]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsxs("label",{className:"form-label",children:["Apellidos",e.jsx("b",{className:"text-danger ms-1",children:"*"})]}),e.jsx("input",{type:"text",className:"form-control",value:o.lastname,onChange:c=>a(i=>({...i,lastname:c.target.value})),required:!0})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{className:"form-label",children:["Email",e.jsx("b",{className:"text-danger ms-1",children:"*"})]}),e.jsx("input",{type:"email",className:"form-control",value:o.email,onChange:c=>a(i=>({...i,email:c.target.value})),required:!0})]}),e.jsxs("label",{htmlFor:"",className:"form-label",children:["Celular",e.jsx("b",{className:"text-danger ms-1",children:"*"})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(X,{dropdownParent:"#new-sale-modal",minimumInputLength:-1,templateResult:r,templateSelection:r,children:s.sort((c,i)=>c.country.localeCompare(i.country)).map((c,i)=>e.jsxs("option",{value:c.realCode,"data-code":c.beautyCode,"data-flag":c.flag,"data-country":c.country,children:[c.beautyCode," ",c.country]},i))})}),e.jsx("div",{className:"col-md-8 mb-2",children:e.jsx("input",{type:"tel",className:"form-control",value:o.phone,onChange:c=>a(i=>({...i,phone:c.target.value})),required:!0})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{className:"form-label",children:["Origen de venta",e.jsx("b",{className:"text-danger ms-1",children:"*"})]}),e.jsxs("select",{className:"form-select",value:o.source,onChange:c=>a(i=>({...i,source:c.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar origen"}),e.jsx("option",{value:"llamada",children:"Llamada telefÃ³nica"}),e.jsx("option",{value:"whatsapp",children:"WhatsApp"}),e.jsx("option",{value:"presencial",children:"Presencial"}),e.jsx("option",{value:"otro",children:"Otro"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Comentario interno"}),e.jsx("textarea",{className:"form-control",value:o.internal_comment,onChange:c=>a(i=>({...i,internal_comment:c.target.value})),rows:3,placeholder:"Ingresa un comentario sobre por quÃ© se estÃ¡ creando esta venta desde interno..."})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("h4",{className:"mt-0",children:"DirecciÃ³n del cliente"}),e.jsx(ee,{label:"Pais",value:"PerÃº",disabled:!0})]}),e.jsxs("div",{className:"col-12 mt-4",children:[e.jsx("h4",{children:"Productos"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-centered table-nowrap",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Color"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Subtotal"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:h.map((c,i)=>{var d,x;return e.jsxs("tr",{children:[e.jsx("td",{children:c.name}),e.jsx("td",{children:e.jsxs("select",{className:"form-select",value:(d=c.color)==null?void 0:d.id,onChange:b=>u(i,b.target.value),children:[e.jsx("option",{value:"",children:"Seleccionar color"}),(x=c.colors)==null?void 0:x.map((b,W)=>e.jsx("option",{value:b.id,children:b.name},W))]})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"form-control",value:c.quantity,onChange:b=>v(i,b.target.value),min:1})}),e.jsxs("td",{children:["S/.",c.price]}),e.jsxs("td",{children:["S/.",(c.price*c.quantity).toFixed(2)]}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-danger btn-sm",onClick:()=>R(),children:e.jsx("i",{className:"fa fa-trash"})})})]},i)})}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end",children:"Subtotal:"}),e.jsxs("td",{children:["S/.",j.toFixed(2)]}),e.jsx("td",{})]}),S,N&&e.jsxs("tr",{children:[e.jsxs("td",{colSpan:4,className:"text-end",children:["CupÃ³n (",N.code,"):"]}),e.jsxs("td",{children:["-S/.",f.toFixed(2)]}),e.jsx("td",{})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end",children:"Total:"}),e.jsxs("td",{children:["S/.",l.toFixed(2)]}),e.jsx("td",{})]})]})]})}),e.jsxs("div",{className:"row mt-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:g,children:[e.jsx("i",{className:"fa fa-plus me-1"}),"Agregar producto"]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"CÃ³digo de cupÃ³n",value:t,onChange:c=>C(c.target.value)}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:E,children:"Aplicar cupÃ³n"})]})})]})]})]}),e.jsxs("div",{className:"text-end mt-4",children:[e.jsx("button",{type:"button",className:"btn btn-light me-2",onClick:()=>$(m.current).modal("hide"),children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Guardar venta"})]})]})})},B=new ne,ce=new te,re=({statuses:m,items:s,phone_prefixes:o})=>{var _,f,l,g,u,v,R,E;const a=p.useRef(),h=p.useRef(),k=p.useRef(),[t,C]=p.useState(null),[N,w]=p.useState([]),F=async n=>{const r=n.target.value,c=$(n.target).find(`option[value="${r}"]`);if(c.data("confirm")){const{isConfirmed:x}=await I.fire({title:"Actualizar estado",text:`Â¿EstÃ¡s seguro de actualizar la venta al estado "${c.text()}"?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Si, actualizar",cancelButtonText:"Cancelar"});if(!x)return}const d=await B.save({id:t.id,status_id:r});d&&(C(d.data),$(a.current).dxDataGrid("instance").refresh())},T=async n=>{const{isConfirmed:r}=await I.fire({title:"Anular pedido",text:"Â¿Estas seguro de anular este pedido?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, anular",cancelButtonText:"Cancelar"});!r||!await B.delete(n)||$(a.current).dxDataGrid("instance").refresh()},j=async n=>{w([]);const r=await B.get(n);C(r),$(h.current).modal("show")};p.useEffect(()=>{t&&ce.bySale(t.id).then(n=>{w(n||[])})},[t]),Number(t==null?void 0:t.amount)+Number(t==null?void 0:t.delivery)-Number(t==null?void 0:t.bundle_discount)-Number(t==null?void 0:t.renewal_discount)-Number(t==null?void 0:t.coupon_discount);const S=t!=null&&t.phone.clean("0-9").startsWith("51")?t==null?void 0:t.phone.clean("0-9"):`51${t==null?void 0:t.phone.clean("0-9")}`;return e.jsxs(e.Fragment,{children:[e.jsx(Z,{gridRef:a,title:"Pedidos",rest:B,toolBar:n=>{n.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(a.current).dxDataGrid("instance").refresh()}}),n.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"Agrega una venta manual",text:"Nueva venta",onClick:()=>$(k.current).modal("show")}})},exportable:!0,pageSize:25,columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"code",caption:"Numero de orden",visible:!1},{dataField:"created_at",caption:"Fecha",dataType:"date",sortOrder:"desc",width:"150px",cellTemplate:(n,{data:r})=>{n.css("cursor","pointer"),n.on("click",()=>{j(r.id)}),q(n,e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"d-block",children:moment(r.created_at.replace("Z","-05:00")).fromNow()}),e.jsx("small",{className:"d-block text-muted",children:moment(r.created_at).format("lll")})]}))}},{dataField:"fullname",caption:"Orden",width:"250px",cellTemplate:(n,{data:r})=>{n.css("cursor","pointer"),n.on("click",()=>{j(r.id)}),q(n,e.jsxs("p",{className:"mb-0",style:{width:"100%"},children:[e.jsxs("b",{className:"d-block w-100 text-truncate",children:[r.renewal&&e.jsx(A,{content:`Plan: ${r.renewal.name}`,children:e.jsx("i",{className:"fa fas fa-spa text-pink me-1"})}),r.name," ",r.lastname]}),e.jsxs("small",{className:"text-nowrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,fontFamily:"monospace"},children:["#",D.APP_CORRELATIVE,"-",r.code]})]}))}},{dataField:"status.name",caption:"Estado",width:"100px",cellTemplate:(n,{data:r})=>{q(n,e.jsx(e.Fragment,{children:e.jsx(A,{content:r.status.description,children:e.jsx("span",{className:"d-block mx-auto badge rounded-pill",style:{backgroundColor:r.status.color?`${r.status.color}2e`:"#3333332e",color:r.status.color??"#333",width:"max-content",marginBottom:"4px"},children:r.status.name})})}))}},{dataField:"total_amount",caption:"Total",dataType:"number",width:"100px",cellTemplate:(n,{data:r})=>{n.text(`S/. ${y(r.total_amount)}`)}},{dataField:"phone",caption:"TelÃ©fono",width:"120px",cellTemplate:(n,{data:r})=>{n.text(r.phone.keep("0-9"))}},{dataField:"email",caption:"Email"},{dataField:"department",caption:"Departamento"},{dataField:"province",caption:"Ciudad",cellTemplate:(n,{data:r})=>{n.text(r.province||r.district)}},{caption:"Acciones",cellTemplate:(n,{data:r})=>{n.append(M({className:"btn btn-xs btn-light",title:"Ver pedido",icon:"fa fa-eye",onClick:()=>j(r.id)})),!r.status.confirm&&n.append(M({className:"btn btn-xs btn-soft-danger",title:"Anular pedido",icon:"fa fa-trash",onClick:()=>T(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(Q,{modalRef:h,title:`Detalles del pedido #${D.APP_CORRELATIVE}-${t==null?void 0:t.code}`,size:"xl",bodyStyle:{backgroundColor:"#ebeff2"},hideButtonSubmit:!0,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Detalles de Venta"})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsx("table",{id:"table-info",className:"table table-borderless table-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Nombres:"}),e.jsxs("td",{children:[t==null?void 0:t.name," ",t==null?void 0:t.lastname]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Email:"}),e.jsx("td",{children:t==null?void 0:t.email})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"TelÃ©fono:"}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-1 align-items-center",children:[e.jsx("img",{className:"avatar-sm rounded-circle",src:`${D.WA_URL}/api/profile/${D.APP_CORRELATIVE}/${S}`,onError:n=>{n.target.onerror=null,n.target.src="/api/admin/profile/thumbnail/undefined"},alt:(t==null?void 0:t.name)+" "+(t==null?void 0:t.lastname)}),e.jsxs("div",{children:[e.jsx("span",{className:"d-block",children:t==null?void 0:t.phone}),e.jsx("a",{href:`//wa.me/${S}`,target:"_blank",children:e.jsxs("small",{children:["Abrir WhatsApp ",e.jsx("i",{className:"mdi mdi-arrow-top-right"})]})})]})]})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"DirecciÃ³n:"}),e.jsxs("td",{children:[t==null?void 0:t.address," ",t==null?void 0:t.number,e.jsxs("small",{className:"text-muted d-block",children:[(t==null?void 0:t.province)??(t==null?void 0:t.district),", ",t==null?void 0:t.department,", ",t==null?void 0:t.country," ",(t==null?void 0:t.zip_code)&&e.jsxs(e.Fragment,{children:["- ",t==null?void 0:t.zip_code]})]})]})]}),(t==null?void 0:t.reference)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Referencia:"}),e.jsx("td",{children:t==null?void 0:t.reference})]}),(t==null?void 0:t.comment)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Comentario:"}),e.jsx("td",{children:t==null?void 0:t.comment})]}),(t==null?void 0:t.billing_type)&&(t==null?void 0:t.billing_number)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Comprobante:"}),e.jsxs("td",{children:[e.jsx("b",{className:"d-block",children:t.billing_type.toTitleCase()}),e.jsxs("small",{children:[e.jsx("code",{className:"me-1",children:t.billing_type=="boleta"?"DNI":"RUC"}),e.jsx("span",{children:t==null?void 0:t.billing_number})]})]})]})]})}),e.jsxs("button",{className:"btn btn-xs btn-dark",type:"button",copy:`Nombres: ${t==null?void 0:t.fullname}
Email: ${t==null?void 0:t.email}
TelÃ©fono: ${t==null?void 0:t.phone}
DirecciÃ³n: ${t==null?void 0:t.address} ${t==null?void 0:t.number}${t!=null&&t.zip_code?`
CÃ³digo Postal: ${t==null?void 0:t.zip_code}`:""}
UbicaciÃ³n: ${(t==null?void 0:t.province)??(t==null?void 0:t.district)}, ${t==null?void 0:t.department}, ${t==null?void 0:t.country}${t!=null&&t.reference?`
Referencia: ${t==null?void 0:t.reference}`:""}${t!=null&&t.comment?`
Comentario: ${t==null?void 0:t.comment}`:""}${t!=null&&t.billing_type&&(t!=null&&t.billing_number)?`
Comprobante: ${t.billing_type.toTitleCase()}
${t.billing_type=="boleta"?"DNI":"RUC"}: ${t==null?void 0:t.billing_number}`:""}`,children:[e.jsx("i",{className:"mdi mdi-content-copy me-1"}),"Copiar"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"ArtÃ­culos"})}),e.jsx("div",{className:"card-body p-2 table-responsive",children:e.jsxs("table",{className:"table table-striped table-bordered table-sm table-hover mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Colores"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Subtotal"})]})}),e.jsx("tbody",{children:(_=t==null?void 0:t.details)==null?void 0:_.map((n,r)=>{var d;const c=n.quantity*100/100,i=n.price*n.quantity;return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("span",{className:"d-block",children:n.name}),n.user_formula_id&&n.user_formula_id!=t.user_formula_id&&e.jsx(A,{content:e.jsx(z,{name:t==null?void 0:t.name,details:t==null?void 0:t.details,formula:n.user_formula}),allowHTML:!0,interactive:!0,children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"mdi mdi-flask me-1"}),"FÃ³rmula secundaria"]})})]}),e.jsx("td",{children:(d=n==null?void 0:n.colors)==null?void 0:d.map((x,b)=>e.jsx(A,{content:x.name,children:e.jsx("i",{className:"mdi mdi-circle",style:{color:x.hex,WebkitTextStroke:"1px #808080"}})},b))}),e.jsxs("td",{align:"right",children:["S/ ",y(n.price)]}),e.jsx("td",{align:"center",children:c}),e.jsxs("td",{align:"right",children:["S/ ",y(i)]})]},r)})})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Resumen"})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Subtotal:"}),e.jsxs("span",{children:["S/ ",y(t==null?void 0:t.amount)]})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"EnvÃ­o:"}),e.jsx("span",{children:(t==null?void 0:t.delivery)===null?"Pago en destino":e.jsxs(e.Fragment,{children:["S/ ",y(t==null?void 0:t.delivery)]})})]}),(t==null?void 0:t.bundle)&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("b",{children:["Descuento x paquete:",e.jsxs("small",{className:"d-block text-muted",style:{fontWeight:"lighter"},children:["Elegiste ",(f=t==null?void 0:t.bundle)==null?void 0:f.name," (-",((l=t==null?void 0:t.bundle)==null?void 0:l.percentage)*1e4/100,"%)"]})]}),e.jsxs("span",{children:["S/ -",y(t==null?void 0:t.bundle_discount)]})]}),(t==null?void 0:t.renewal)&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("b",{children:["SubscripciÃ³n:",e.jsxs("small",{className:"d-block text-muted",style:{fontWeight:"lighter"},children:[(g=t==null?void 0:t.renewal)==null?void 0:g.name," (-",((u=t==null?void 0:t.renewal)==null?void 0:u.percentage)*1e4/100,"%)"]})]}),e.jsxs("span",{children:["S/ -",y(t==null?void 0:t.renewal_discount)]})]}),(t==null?void 0:t.coupon)&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("b",{children:["CupÃ³n aplicado:",e.jsxs("small",{className:"d-block text-muted",style:{fontWeight:"lighter"},children:[(v=t==null?void 0:t.coupon)==null?void 0:v.name," (-",((R=t==null?void 0:t.coupon)==null?void 0:R.amount)*100/100,"%)"]})]}),e.jsxs("span",{children:["S/ -",y(t==null?void 0:t.coupon_discount)]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Total:"}),e.jsx("span",{children:e.jsxs("strong",{children:["S/ ",y(t==null?void 0:t.total_amount)]})})]})]})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Formula principal"})}),e.jsx("div",{className:"card-body p-2",children:e.jsx(z,{name:t==null?void 0:t.name,details:t==null?void 0:t.details,formula:t==null?void 0:t.formula})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Estado"})}),e.jsx("div",{className:"card-body p-2",children:e.jsxs("div",{className:"",children:[e.jsx("label",{htmlFor:"statusSelect",className:"form-label",children:"Estado Actual"}),e.jsx("select",{className:"form-select",id:"statusSelect",value:t==null?void 0:t.status_id,onChange:F,disabled:!((E=t==null?void 0:t.status)!=null&&E.reversible),children:m.map((n,r)=>e.jsx("option",{value:n.id,"data-confirm":!!n.confirm,children:n.name},r))})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Cambios de Estado"})}),e.jsx("div",{className:"card-body p-2 d-flex flex-column gap-1",style:{maxHeight:"300px",overflowY:"auto"},children:N==null?void 0:N.map((n,r)=>{var i,d,x;const c=`${((i=n.user)==null?void 0:i.name)||""} ${((d=n.user)==null?void 0:d.lastname)||""}`.trim()||"AutomÃ¡tico";return e.jsxs("article",{className:"border py-1 px-2 ms-3",style:{position:"relative",borderRadius:"16px 4px 4px 16px",backgroundColor:n.status.color?`${n.status.color}2e`:"#3333332e"},children:[e.jsx("i",{className:"mdi mdi-circle left-2",style:{color:n.status.color||"#333",position:"absolute",left:"-25px",top:"50%",transform:"translateY(-50%)"}}),e.jsx("b",{style:{color:n.status.color||"#333"},children:(x=n==null?void 0:n.status)==null?void 0:x.name}),e.jsx("small",{className:"d-block text-truncate",children:c}),e.jsx("small",{className:"d-block text-muted",children:moment(n.created_at).format("YYYY-MM-DD HH:mm")})]},r)})})]})]})]})}),e.jsx(se,{modalRef:k,phone_prefixes:o})]})};J((m,s)=>{H(m).render(e.jsx(V,{...s,title:"Pedidos",children:e.jsx(re,{...s})}))});
