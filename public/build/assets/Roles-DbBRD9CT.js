import{R as t,r as n}from"./Footer-B80Lgev0.js";import{c as D}from"./ReactAppend-BbdAvxK7.js";import{C as A}from"./CreateReactScript-QlbMmlWm.js";import{R as p}from"./ReactAppend-BdSt2FVL.js";import{P as v}from"./PermissionsRest-BWS04-FT.js";import{R as E}from"./RolesRest-SrtbPD5t.js";import{A as G}from"./Adminto-BGAXhy00.js";import{M as x}from"./Modal-XkEoS3lt.js";import{T as S}from"./Table-w4bmKtdW.js";import{C as M}from"./CheckboxFormGroup-DLi5doGv.js";import{I as P}from"./InputFormGroup-CZpmvUlF.js";import{T as B}from"./TextareaFormGroup-CH1nUIqS.js";import{T as R}from"./TippyButton-DwRY6mBw.js";import"./MenuItem-COCTGmIB.js";import"./___vite-browser-external_commonjs-proxy-BiUUwCOo.js";import"./NavBar-BThilt_4.js";import"./WhatsAppStatuses-BF-FjpQX.js";import"./TippyButton-TBKQ4cvW.js";const _=({id:s,children:a,className:i})=>t.createElement("div",{id:s,className:`accordion custom-accordion ${i}`},a),I=({title:s,id:a,parent:i,children:c,className:m,isOpened:l})=>t.createElement("div",{className:"card mb-1"},t.createElement("div",{className:"card-header p-0",id:`heading-${a}`},t.createElement("h5",{className:"m-0"},t.createElement("a",{className:`d-block text-dark ${!l&&"collapsed"} p-2`,"data-bs-toggle":"collapse",href:`#${a}`,"aria-expanded":"false"},s))),t.createElement("div",{id:a,className:`collapse ${l&&"show"}`,"aria-labelledby":`heading-${a}`,"data-bs-parent":`#${i}`},t.createElement("div",{className:`card-body p-2 ${m}`},c))),L=({permissions:s})=>{s=Object.values(s.map(e=>{const[r]=e.name.split(".");return{...e,origin:r}}).reduce((e,r)=>(e[r.origin]||(e[r.origin]=[]),e[r.origin].push(r),e),{}));const a=n.useRef(),i=n.useRef(),c=n.useRef();n.useRef();const m=n.useRef(),l=n.useRef(),f=n.useRef(),[y,b]=n.useState(!1),[h,N]=n.useState({}),g=e=>{e!=null&&e.id?b(!0):b(!1),m.current.value=(e==null?void 0:e.id)||null,l.current.value=(e==null?void 0:e.name)||null,f.current.value=(e==null?void 0:e.description)||null,$(i.current).modal("show")},k=async e=>{N(e);const r=await v.byRole(e.id);$("#permissions input").prop("checked",!1),r.forEach(({name:o})=>{$(`[name="${o}"]`).prop("checked",!0)}),$(c.current).modal("show")},w=async e=>{e.preventDefault();const r={id:m.current.value||void 0,name:l.current.value,description:f.current.value};await E.save(r)&&($(a.current).dxDataGrid("instance").refresh(),$(i.current).modal("hide"))},T=async e=>{e.preventDefault();const r=[...$("#permissions input:checked")].map(d=>d.value),o={role_id:h.id,permissions:r};await v.massiveByRole(o)&&($(c.current).modal("hide"),$(a.current).dxDataGrid("instance").refresh())},F=async e=>{await E.delete(e)&&$(a.current).dxDataGrid("instance").refresh()};return t.createElement(t.Fragment,null,t.createElement(S,{gridRef:a,title:"Roles",rest:E,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(a.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"Nuevo registro",onClick:()=>g()}})},columns:[{dataField:"id",caption:"ID",dataType:"number",sortOrder:"asc"},{dataField:"name",caption:"Rol"},{dataField:"description",caption:"Descripcion"},{dataField:"created_at",caption:"Fecha creacion",dataType:"date",cellTemplate:(e,{data:r})=>{p(e,t.createElement("span",null,moment(r.created_at).format("LL")))}},{dataField:"updated_at",caption:"Fecha actualizacion",dataType:"date",cellTemplate:(e,{data:r})=>{p(e,t.createElement("span",null,moment(r.updated_at).format("LL")))}},{caption:"Acciones",cellTemplate:(e,{data:r})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),p(e,t.createElement(R,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>g(r)},t.createElement("i",{className:"fa fa-pen"}))),p(e,t.createElement(R,{className:"btn btn-xs btn-soft-dark",title:"Modificar permisos",onClick:()=>k(r),"data-loading-text":'<i class="fa fa-spinner fa-spin"></i>'},t.createElement("i",{className:"fas fa-th-list"}))),p(e,t.createElement(R,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>F(r.id)},t.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}]}),t.createElement(x,{modalRef:i,title:y?"Editar rol":"Agregar rol",onSubmit:w},t.createElement("div",{className:"row"},t.createElement("input",{ref:m,type:"hidden"}),t.createElement(P,{eRef:l,label:"Rol",col:"col-12",required:!0}),t.createElement(B,{eRef:f,label:"Descripcion",col:"col-12"}))),t.createElement(x,{modalRef:c,title:`Permisos para ${h.name}`,btnSubmitText:"Guardar",onSubmit:T,size:"sm"},t.createElement(_,{id:"permissions"},s.map((e,r)=>{const o=e[0].origin;return t.createElement(I,{key:`accordion-${r}`,id:`permission-${o}`,title:o,parent:"permissions",className:"d-flex gap-2 flex-wrap flex-row"},e.map(({id:u,name:d,description:C})=>t.createElement(M,{key:`permission-${u}`,className:"mb-0",id:`permission-ck-${u}`,label:d.replace(`${o}.`,""),name:d,value:u,title:C,style:{width:"max-content"},rounded:!0})))}))))};A((s,a)=>{D(s).render(t.createElement(G,{...a,title:"Roles"},t.createElement(L,{...a})))});
