var P=Object.defineProperty;var E=(o,r,t)=>r in o?P(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t;var g=(o,r,t)=>(E(o,typeof r!="symbol"?r+"":r,t),t);import{j as e}from"./StatisticCard-Bdo2C3ON.js";import{r as l}from"./index-DFv2mRv-.js";import{c as O}from"./ReactAppend-CwiwA4iz.js";import{C as T}from"./CreateReactScript-yWJ4gJYl.js";import{I as h}from"./InputFormGroup-B5shSbO3.js";import{i as C}from"./tippy-react.esm-BVvHiWwH.js";/* empty css              */import{m as x}from"./main-BBbUrZUL.js";import{S as k}from"./SelectFormGroup-CEMe1OMM.js";import{Q as U}from"./QuillFormGroup-DCWD3Stq.js";import{B as q}from"./Base-zNxy_CdJ.js";import"./index-DgyC5pTR.js";import"./index.esm-B502ZfUP.js";import"./___vite-browser-external_commonjs-proxy-BQdpDcDf.js";/* empty css               */class j{}g(j,"save",async r=>{try{const{status:t,result:a}=await x.Fetch("/api/profile",{method:"PATCH",body:JSON.stringify(r)});if(!t)throw new Error((a==null?void 0:a.message)||"Ocurrio un error inesperado");return x.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:a.message,type:"success"}),!0}catch(t){return x.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),!1}}),g(j,"saveProfile",async(r,t=!0)=>{try{const{full:a,thumbnail:c,type:n,ok:m}=await File.compress(r,{square:t});if(!m)throw new Error("Ocurrio un error al comprimir la imagen. Intenta con otra.");const f=new FormData;f.append("thumbnail",await File.fromURL(`data:${n};base64,${c}`)),f.append("full",await File.fromURL(`data:${n};base64,${a}`));const d=await fetch("/api/profile",{method:"POST",headers:{"X-Xsrf-Token":decodeURIComponent(x.Cookies.get("XSRF-TOKEN"))},body:f}),v=JSON.parseable(await d.text());if(!d.ok)throw new Error((v==null?void 0:v.message)??"Ocurrio un error inesperado");return x.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:"La imagen de perfil se actualizo correctamente",type:"success"}),v.data}catch(a){return x.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:a.message,type:"danger"}),!1}});const I=({col:o,label:r,eRef:t,placeholder:a,required:c=!1,rows:n=3,value:m})=>e.jsxs("div",{className:`form-group ${o} mb-2`,children:[e.jsxs("label",{htmlFor:"",children:[r," ",c&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("textarea",{ref:t,className:"form-control",placeholder:a,required:c,rows:n,defaultValue:m,style:{minHeight:n*27,fieldSizing:"content"}})]});class D{constructor(){g(this,"saveCover",async r=>{try{const{full:t,thumbnail:a,type:c,ok:n}=await File.compress(r);if(!n)throw new Error("Ocurrio un error al comprimir la portada. Intenta con otra.");const m=new FormData;m.append("thumbnail",await File.fromURL(`data:${c};base64,${a}`)),m.append("full",await File.fromURL(`data:${c};base64,${t}`));const f=await fetch("/api/cover",{method:"POST",headers:{"X-Xsrf-Token":decodeURIComponent(x.Cookies.get("XSRF-TOKEN"))},body:m}),d=JSON.parseable(await f.text());if(!f.ok)throw new Error((d==null?void 0:d.message)??"Ocurrio un error inesperado");return x.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:"La imagen de portada se actualizo correctamente",type:"success"}),d.data}catch(t){return x.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:t.message,type:"danger"}),!1}})}}const L=new D,X=o=>{const{countries:r}=o,t=l.useRef(),a=l.useRef(),c=l.useRef(),n=l.useRef(),m=l.useRef(),f=l.useRef(),d=l.useRef(),v=l.useRef(),N=l.useRef(),R=l.useRef(),w=l.useRef(),[s,y]=l.useState(o.session),F=async p=>{p.preventDefault();const i={name:t.current.value,lastname:a.current.value,dni:c.current.value,phone:n.current.value,video:m.current.value,title:f.current.value,country:d.current.value,city:v.current.value,address:N.current.value,summary:R.current.value,description:w.current.value};if(!await j.save(i))return;const u=structuredClone(s);u.name=i.name,u.lastname=i.lastname,u.birthdate=i.birthdate,y(u)},$=async p=>{const i=p.target.files[0];if(!i)return;const b=await j.saveProfile(i,!1);if(!b)return;const u=structuredClone(s);u.uuid=b.uuid,y(u)},S=async p=>{const i=p.target.files[0];if(!i)return;const b=await L.saveCover(i);if(!b)return;const u=structuredClone(s);u.uuid=b.uuid,y(u)};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"row justify-content-center align-items-center",style:{minHeight:"calc(100vh - 135px)"},children:e.jsx("div",{className:"col-xl-8 col-lg-9 col-md-10 col-sm-11 col-xs-12",children:e.jsxs("form",{className:"card",onSubmit:F,children:[e.jsx("div",{className:"card-header",children:e.jsx("h4",{className:"card-title mb-0",children:"Perfil"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-sm-4 col-xs-12 position-relative",children:[e.jsx(C,{content:"Cambiar portada",arrow:!0,children:e.jsxs("label",{htmlFor:"cover",className:"ratio ratio-21x9",style:{cursor:"pointer"},children:[e.jsx("input",{className:"d-none",type:"file",name:"cover",id:"cover",accept:"image/*",onChange:S}),e.jsx("img",{src:`/api/cover/${s.uuid}?v=${crypto.randomUUID()}`,alt:`Perfil de ${s.name} ${s.lastname}`,style:{width:"100%",objectFit:"cover",objectPosition:"center",borderRadius:"4px"}})]})}),e.jsx(C,{content:"Cambiar foto de perfil",arrow:!0,children:e.jsxs("label",{htmlFor:"avatar",className:"rounded-circle mx-auto d-block position-relative",style:{cursor:"pointer",width:"max-content",marginTop:"-48px"},children:[e.jsx("input",{className:"d-none",type:"file",name:"avatar",id:"avatar",accept:"image/*",onChange:$}),e.jsx("img",{className:"avatar-xl rounded-circle bg-white",src:`/api/profile/${s.uuid}?v=${crypto.randomUUID()}`,alt:`Perfil de ${s.name} ${s.lastname}`,style:{objectFit:"cover",objectPosition:"center"}})]})}),e.jsxs("ul",{className:"social-list list-inline mt-3 mb-0",children:[e.jsx("li",{className:"list-inline-item",children:e.jsx("a",{href:"#",className:"social-list-item border-purple text-purple",children:e.jsx("i",{className:"fab fa-facebook-f"})})}),e.jsx("li",{className:"list-inline-item",children:e.jsx("a",{href:"#",className:"social-list-item border-danger text-danger",children:e.jsx("i",{className:"mdi mdi-google"})})}),e.jsx("li",{className:"list-inline-item",children:e.jsx("a",{href:"#",className:"social-list-item border-info text-info",children:e.jsx("i",{className:"mdi mdi-twitter"})})}),e.jsx("li",{className:"list-inline-item",children:e.jsx("a",{href:"#",className:"social-list-item border-secondary text-secondary",children:e.jsx("i",{className:"mdi mdi-github"})})})]})]}),e.jsxs("div",{className:"col-sm-8 col-xs-12",children:[e.jsxs("div",{className:"row",children:[e.jsx(h,{eRef:t,label:"Nombres",value:s.name,required:!0,col:"col-md-6 col-sm-12"}),e.jsx(h,{eRef:a,label:"Apellidos",value:s.lastname,required:!0,col:"col-md-6 col-sm-12"}),e.jsx(h,{eRef:c,label:"DNI",value:s.dni,required:!0,col:"col-md-6 col-sm-12"}),e.jsx(h,{eRef:n,label:"Telefono",value:s.phone,col:"col-md-6 col-sm-12"}),e.jsx(h,{eRef:m,label:"Video de YouTube",value:`https://youtu.be/${s.video}`}),e.jsx(h,{eRef:f,label:"Titulo",value:s.title,col:"col-md-6 col-sm-12",required:!0}),e.jsx(k,{eRef:d,label:"Pais",value:s.country,col:"col-md-6 col-sm-12",required:!0,children:r.map((p,i)=>e.jsx("option",{value:p.id,selected:p.id==s.country,children:p.name},`country-${i}`))}),e.jsx(h,{eRef:v,label:"Ciudad",value:s.city,col:"col-md-6 col-sm-12",required:!0}),e.jsx(h,{eRef:N,label:"Direccion",value:s.address,col:"col-md-6 col-sm-12"}),e.jsx(I,{eRef:R,label:"Resumen",col:"col-12",value:s.summary}),e.jsx(U,{eRef:w,label:"Descripcion",col:"col-12",value:s.description,height:"240px",required:!0})]}),e.jsx("div",{className:"text-center",children:e.jsxs("button",{className:"btn btn-primary btn-block",type:"submit",children:[e.jsx("i",{className:"fa fa-save"})," Actualizar"]})}),e.jsx("hr",{className:"mt-3 mb-2"}),e.jsx("p",{className:"card-text text-center",children:e.jsxs("small",{className:"text-muted",children:["Ultima actualizacion ",moment(s.updated_at).fromNow()]})})]})]})})]})})})})};T((o,r)=>{O(o).render(e.jsx(q,{...r,title:"Perfil de usuario",children:e.jsx(X,{...r})}))});
