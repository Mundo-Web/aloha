var j=Object.defineProperty;var y=(i,a,r)=>a in i?j(i,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[a]=r;var m=(i,a,r)=>(y(i,typeof a!="symbol"?a+"":a,r),r);import{j as e}from"./AboutHeader-DEdD30eg.js";import{r as n}from"./index-RYns6xqu.js";import{c as b}from"./ReactAppend-vpV7VTGG.js";import"./server.browser-D0dT10Bs.js";import{C as F}from"./CreateReactScript-CXQforvT.js";import{B as N}from"./Base-DXXGQT4E.js";import{D as p,T as x}from"./DxPanelButton-Btlpx-3Z.js";import{R as l}from"./ReactAppend-DPXaoPQG.js";import{T as R,D as g}from"./Table-Bi4FivVB.js";import{S as T}from"./SendingHistoryRest-CCFDjEcX.js";import{M as w}from"./Modal-rZoicGxC.js";import{B as k}from"./BasicRest-Dts8qu_l.js";import"./index-CXU7o9CY.js";import"./index.esm-Bla6j_hB.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./main-BjVPLcVK.js";/* empty css               *//* empty css              */import"./WhatsAppModal-CqtV5vQS.js";import"./sweetalert2.all-DJo0UVK6.js";class v extends k{constructor(){super(...arguments);m(this,"path","admin/mailing/history-details");m(this,"hasFiles",!0)}}const u=new T,C=new v,D=()=>{const i=n.useRef(),a=n.useRef(),r=n.useRef();n.useRef(),n.useRef(),n.useRef(),n.useRef();const[d,c]=n.useState(!1),f=t=>{c(t),$(r.current).modal("show")},h=async t=>{await u.reSend(t)&&$(i.current).dxDataGrid("instance").refresh()};return e.jsxs(e.Fragment,{children:[e.jsx(R,{gridRef:i,title:e.jsx("h4",{className:"header-title my-0",children:"Historial de envios"}),rest:u,toolBar:t=>{t.unshift(p({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(i.current).dxDataGrid("instance").refresh()}))},pageSize:25,columns:[{dataField:"created_at",dataType:"datetime",caption:"Fecha",width:"180px",sortOrder:"desc",cellTemplate:(t,{data:s})=>{var o;t.text(moment((o=s.created_at)==null?void 0:o.replace("Z","+00:00")).format("lll"))}},{dataField:"type",caption:"Tipo",width:"120px",cellTemplate:(t,{value:s})=>{s=="WhatsApp"?l(t,e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-whatsapp me-1"}),s]})):l(t,e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-email me-1"}),s]}))}},{dataField:"name",caption:"Plantilla"},{dataField:"completed",caption:"Completados",dataType:"number",width:"80px",cssClass:"text-success font-bold"},{dataField:"failed",caption:"Fallidos",dataType:"number",width:"80px",cssClass:"text-danger font-bold"},{dataField:"total",caption:"Total",dataType:"number",width:"80px",cssClass:"text-primary font-bold"},{dataField:"status",caption:"Estado",dataType:"boolean",width:"140px",cellTemplate:(t,{data:s})=>{if(s.status===1&&l(t,e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-check me-1"}),e.jsx("span",{children:"Terminado"})]})),s.status===0&&l(t,e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-alert me-1"}),e.jsx("span",{children:"Fallido"})]})),s.status===null){const o=(s.completed+s.failed)/s.total*100;l(t,e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-spin mdi-autorenew me-1"}),e.jsx("span",{className:"me-1",children:"En curso"}),e.jsxs("small",{className:"text-muted",children:[o.toFixed(2),"%"]})]}))}},lookup:{dataSource:[{key:1,value:"Completado"},{key:0,value:"Enviando"},{key:null,value:"Pendiente"}],valueExpr:"key",displayExpr:"value"}},{caption:"Acciones",width:"130px",cellTemplate:(t,{data:s})=>{t.attr("style","display: flex; gap: 4px; overflow: unset"),s.status===0&&l(t,e.jsx(x,{className:"btn btn-xs btn-soft-primary",title:"Reintentar envio",onClick:()=>h(s.id),children:e.jsx("i",{className:"mdi mdi-reload"})})),s.status!==null&&l(t,e.jsx(x,{className:"btn btn-xs btn-soft-dark",title:"Ver detalles de envio",onClick:()=>f(s),children:e.jsx("i",{className:"mdi mdi-format-list-bulleted-type"})}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(w,{modalRef:r,title:e.jsxs("div",{children:[e.jsx("h4",{className:"modal-title my-0",children:"Detalles de envío"}),e.jsx("small",{className:"text-muted",children:d==null?void 0:d.name})]}),size:"xl",onClose:()=>c(null),hideFooter:!0,children:e.jsx(g,{gridRef:a,rest:C,filterValue:["sending_history_id","=",(d==null?void 0:d.id)??null],toolBar:t=>{t.unshift(p({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(a.current).dxDataGrid("instance").refresh()}))},pageSize:25,allowQueryBuilder:!1,columns:[{dataField:"sending_history_id",caption:"ID Historial",visible:!1},{dataField:"sent_to",caption:"Destinatario"},{dataField:"seen",caption:"Visualización",dataType:"boolean",cellTemplate:(t,{data:s})=>{l(t,s.status?e.jsxs("span",{className:"text-primary font-bold",children:[e.jsx("i",{className:"mdi mdi-email-open me-1"}),"Abierto"]}):e.jsxs("span",{className:"text-muted",children:[e.jsx("i",{className:"mdi mdi-email me-1"}),"No abierto"]}))},width:"150px"},{dataField:"status",caption:"Estado",dataType:"boolean",cellTemplate:(t,{data:s})=>{l(t,s.status?e.jsxs("span",{className:"text-success font-bold",children:[e.jsx("i",{className:"mdi mdi-check me-1"}),"Enviado"]}):e.jsxs("span",{className:"text-danger font-bold",children:[e.jsx("i",{className:"mdi mdi-alert me-1"}),"No enviado"]}))},width:"150px"},{dataField:"error",caption:"Error",cssClass:"text-danger"},{dataField:"created_at",dataType:"datetime",caption:"Fecha",width:"200px",sortOrder:"desc",cellTemplate:(t,{data:s})=>{var o;l(t,e.jsx(e.Fragment,{children:moment((o=s.created_at)==null?void 0:o.replace("Z","+00:00")).format("lll")}))}}]})})]})};F((i,a)=>{b(i).render(e.jsx(N,{...a,title:"Historial de envios",children:e.jsx(D,{...a})}))});
