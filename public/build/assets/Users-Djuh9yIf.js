import{J as D}from"./JSEncrypt-D3I3x59l.js";import{r as l,R as t}from"./Footer-B80Lgev0.js";import{c as S}from"./ReactAppend-BbdAvxK7.js";import{C as I}from"./CreateReactScript-QlbMmlWm.js";import{R as w}from"./ReactAppend-BdSt2FVL.js";import{S as U}from"./SetSelectValue-DL-AgtMG.js";import{R as j}from"./RolesRest-SrtbPD5t.js";import{U as h}from"./UsersRest-DgfedDod.js";import{A as q}from"./Adminto-BGAXhy00.js";import{M as G}from"./Modal-XkEoS3lt.js";import{T as P}from"./Table-w4bmKtdW.js";import{I as C}from"./InputFormGroup-CZpmvUlF.js";import{P as k}from"./PasswordFormGroup-CkglPy2s.js";import{m as N}from"./NavBar-BThilt_4.js";import"./TippyButton-TBKQ4cvW.js";import{r as O}from"./DxBox-7VSXldqw.js";import{D as v}from"./DxButton-CsjWvhyj.js";import"./MenuItem-COCTGmIB.js";import"./___vite-browser-external_commonjs-proxy-BiUUwCOo.js";import"./BusinessIWorkCard-rEAJw_L_.js";import"./WhatsAppStatuses-BF-FjpQX.js";const B=({col:a,label:c,eRef:s,required:m=!1,dropdownParent:p,searchAPI:i,searchBy:n,multiple:b=!1,filter:u=null,onChange:g=()=>{},templateResult:E,templateSelection:R})=>(s||(s=l.useRef()),l.useEffect(()=>{$(s.current).select2({dropdownParent:p,minimumInputLength:0,ajax:{url:i,headers:{Accept:"application/json","Content-Type":"application/json","X-Xsrf-Token":decodeURIComponent(N.Cookies.get("XSRF-TOKEN"))},type:"POST",quietMillis:50,data:function({term:o,page:f}){return N.JSON.stringify({sort:[{selector:n,desc:!1}],skip:((f??1)-1)*10,take:10,filter:u?[[n,"contains",o||""],"and",u]:[n,"contains",o||""]})},processResults:function(o,{page:f}){return{results:((o==null?void 0:o.data)??[]).map(d=>{const x=N.JSON.flatten(d);return{id:d.id,text:x[n],data:d}}),pagination:{more:(f??1)*10<o.totalCount}}}},templateResult:E,templateSelection:R})},[p,u]),l.useEffect(()=>{$(s.current).on("change",g)},[u]),t.createElement("div",{className:`form-group ${a} mb-2`},t.createElement("label",{htmlFor:""},c," ",m&&t.createElement("b",{className:"text-danger"},"*")),t.createElement("select",{ref:s,required:m,className:"form-control",style:{width:"100%"},multiple:b}))),M=(a,c=!0)=>$("<div>").css({display:"flex",gap:"8px",alignItems:"flex-center",justifyContent:"flex-start"}).dxBox({direction:"row",items:a.filter(Boolean).map(s=>({ratio:0,baseSize:"auto",template:function(m,p,i){if(c)if(l.isValidElement(s)){const n=document.createElement("div");S(n).render(s),i.append(n)}else{const n=document.createElement("div");n.style.width=s.width,n.style.height=s.height,S(n).render(s.children),i.append(n)}else i.append(O(s))}}))}),J=({can:a,PUBLIC_RSA_KEY:c})=>{const s=l.useRef(),m=l.useRef(),p=l.useRef(),i=l.useRef(),n=l.useRef(),b=l.useRef(),u=l.useRef(),g=l.useRef(),E=l.useRef(),R=new D;R.setPublicKey(c);const[o,f]=l.useState(!1),d=async e=>{e!=null&&e.id?f(!0):f(!1);const r=await j.byUser(e==null?void 0:e.id);p.current.value=(e==null?void 0:e.id)||null,i.current.value=(e==null?void 0:e.name)||null,n.current.value=(e==null?void 0:e.lastname)||null,b.current.value=(e==null?void 0:e.email)||null,U(u.current,r,"id","name"),g.current.value=null,E.current.value=null,$(m.current).modal("show")},x=async e=>{e.preventDefault();const r=g.current.value,y=E.current.value,F={id:p.current.value||void 0,name:i.current.value,lastname:n.current.value,email:b.current.value,roles:$(u.current).val(),password:r?R.encrypt(r):void 0,confirm:y?R.encrypt(y):void 0};await h.save(F)&&($(s.current).dxDataGrid("instance").refresh(),$(m.current).modal("hide"))},A=async({id:e,status:r})=>{await h.status({id:e,status:r})&&$(s.current).dxDataGrid("instance").refresh()},T=async e=>{await h.delete(e)&&$(s.current).dxDataGrid("instance").refresh()};return t.createElement(t.Fragment,null,t.createElement(P,{gridRef:s,title:"Usuarios",rest:h,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(s.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"Nuevo registro",onClick:()=>d()}})},columns:[{dataField:"id",caption:"ID",dataType:"number",sortOrder:"asc"},{dataField:"name",caption:"Nombres"},{dataField:"lastname",caption:"Apellidos"},{dataField:"email",caption:"Correo",dataType:"email",cellTemplate:(e,{data:r})=>{e.append(M([t.createElement("img",{className:"avatar-xs rounded-circle",src:`/api/profile/thumbnail/${r.uuid}`,alt:r.name}),t.createElement("p",{className:"mb-0",style:{fontSize:"14px"}},r.email)],!1))}},{dataField:"status",caption:"Estado",dataType:"boolean",cellTemplate:(e,{data:r})=>{switch(r.status){case 1:w(e,t.createElement("span",{className:"badge bg-success rounded-pill"},"Activo"));break;case 0:w(e,t.createElement("span",{className:"badge bg-danger rounded-pill"},"Inactivo"));break;default:w(e,t.createElement("span",{className:"badge bg-dark rounded-pill"},"Eliminado"));break}}},{caption:"Acciones",cellTemplate:(e,{data:r})=>{a("users","root","all","update")&&e.append(v({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>d(r)})),a("projects","root","all","assignUsers")&&e.append(v({className:"btn btn-xs btn-soft-info",title:"Asignar proyectos",icon:"fas fa-folder-plus",onClick:()=>onAssignProjects()})),a("users","root","all","update")&&e.append(v({className:"btn btn-xs btn-light",title:r.status===null?"Restaurar":"Cambiar estado",icon:r.status===1?"fa fa-toggle-on text-success":r.status===0?"fa fa-toggle-off text-danger":"fas fa-trash-restore",onClick:()=>A(r)})),a("users","root","all","delete")&&e.append(v({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash-alt",onClick:()=>T(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),t.createElement(G,{modalRef:m,title:o?"Editar usuario":"Agregar usuario",onSubmit:x},t.createElement("div",{className:"row",id:"users-crud-container"},t.createElement("input",{ref:p,type:"hidden"}),t.createElement(C,{eRef:i,label:"Nombres",col:"col-md-6",required:!0}),t.createElement(C,{eRef:n,label:"Apellidos",col:"col-md-6",required:!0}),t.createElement(C,{eRef:b,label:"Correo",col:"col-12",type:"email",required:!0}),t.createElement(B,{eRef:u,label:"Asignar roles",col:"col-12",dropdownParent:"#users-crud-container",searchAPI:"/api/roles/paginate",searchBy:"name",required:!0,multiple:!0}),t.createElement(k,{eRef:g,label:"Contraseña",col:"col-md-6",required:!o}),t.createElement(k,{eRef:E,label:"Repetir contraseña",col:"col-md-6",required:!o}))))};I((a,c)=>{S(a).render(t.createElement(q,{...c,title:"Usuarios"},t.createElement(J,{...c})))});
