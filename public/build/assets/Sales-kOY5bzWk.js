var M=Object.defineProperty;var Y=(l,i,c)=>i in l?M(l,i,{enumerable:!0,configurable:!0,writable:!0,value:c}):l[i]=c;var k=(l,i,c)=>(Y(l,typeof i!="symbol"?i+"":i,c),c);import{j as e}from"./AboutHeader-CpM0iYLI.js";import{B as G}from"./Base-CNDiEzgL.js";import{i as T}from"./tippy-react.esm-CHhA99mn.js";import{r as y}from"./index-B80Lgev0.js";import{c as V}from"./ReactAppend-CBRQCQGz.js";import{r as q}from"./server.browser-D3N0_gce.js";import{S as B}from"./sweetalert2.all-Dh0rZL5X.js";import{m as D}from"./main-B2CtU6ez.js";import{B as W}from"./Results-DSLuSBy_.js";import{M as H}from"./Modal-B4tqXYU4.js";import{T as U}from"./Table-BWTpfkzD.js";import{D as P}from"./DxButton-CsjWvhyj.js";import{C as Z,G as F}from"./CreateReactScript-CL6ujVDa.js";import{N as m}from"./Number2Currency-e57Tgsuk.js";import{R as O}from"./ReactAppend-C-tNgxIf.js";/* empty css              */import"./Logout-CPQZ59pt.js";import"./index.esm-Cu-mVv1q.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./WhatsAppModal-CjZ0YwJN.js";import"./index-DO3Aws4m.js";/* empty css               */class J extends W{constructor(){super(...arguments);k(this,"path","admin/sale-statuses");k(this,"bySale",async c=>{try{const{status:t,result:a}=await D.Fetch(`/api/${this.path}/by-sale/${c}`);if(!t)throw new Error((a==null?void 0:a.message)||"Ocurrio un error inesperado");return a.data}catch(t){return D.Notify.add({icon:"/assets/img/favicon.png",title:"Error",body:t.message,type:"danger"}),null}})}}class K extends W{constructor(){super(...arguments);k(this,"path","admin/sales")}}const z=({name:l,formula:i,details:c})=>{var a,d,j,v,_,b,w,u,N,f;const t=c==null?void 0:c.filter(r=>!r.user_formula_id||r.user_formula_id==i.id);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("b",{children:"ðŸ§ Tratamiento"}),":"," ",(a=i==null?void 0:i.has_treatment)==null?void 0:a.description]}),e.jsxs("div",{children:[e.jsx("b",{children:"ðŸ‘€ Cuero cabelludo"}),": "," ",(d=i==null?void 0:i.scalp_type)==null?void 0:d.description]}),e.jsxs("div",{children:[e.jsx("b",{children:"âœ… Tipo de cabello"}),":"," ",(j=i==null?void 0:i.hair_type)==null?void 0:j.description]}),e.jsxs("div",{children:[e.jsx("b",{children:"ðŸ’¡ Objetivos"}),":"," ",e.jsx("ul",{className:"mb-0",children:(v=i==null?void 0:i.hair_goals_list)==null?void 0:v.map(r=>e.jsx("li",{children:r.description},r.id))})]}),e.jsxs("div",{children:[e.jsx("b",{children:"ðŸ«™ Fragancia"}),":"," ",(_=i==null?void 0:i.fragrance)==null?void 0:_.name]}),e.jsxs("div",{children:[e.jsx("b",{children:"ðŸŽ¨ Colores:"}),e.jsx("ul",{children:t==null?void 0:t.map((r,x)=>{var p;return e.jsxs("li",{children:[r.name,": ",(p=r==null?void 0:r.colors)==null?void 0:p.map(C=>C.name).join(", ")]},x)})})]}),e.jsxs("button",{className:"btn btn-xs btn-dark",type:"button",copy:`*Formula ${l}*

ðŸ§ Tratamiento: ${(b=i==null?void 0:i.has_treatment)==null?void 0:b.description}
ðŸ‘€ Cuero cabelludo: ${(w=i==null?void 0:i.scalp_type)==null?void 0:w.description}
âœ… Tipo de cabello: ${(u=i==null?void 0:i.hair_type)==null?void 0:u.description}
ðŸ’¡ Objetivos:
${(N=i==null?void 0:i.hair_goals_list)==null?void 0:N.map(r=>`- ${r.description}`).join(`
`)}
ðŸ«™ Fragancia: ${(f=i==null?void 0:i.fragrance)==null?void 0:f.name}
ðŸŽ¨ Colores:
${t==null?void 0:t.map(r=>{var x;return`- ${r.name}: ${(x=r==null?void 0:r.colors)==null?void 0:x.map(p=>p.name).join(", ")}`}).join(`
`)}`,children:[e.jsx("i",{className:"mdi mdi-content-copy me-1"}),"Copiar"]})]})},R=new K,Q=new J,X=({statuses:l})=>{var N,f,r,x,p,C,E,A;const i=y.useRef(),c=y.useRef(),[t,a]=y.useState(null),[d,j]=y.useState([]),v=async n=>{const s=n.target.value,o=$(n.target).find(`option[value="${s}"]`);if(o.data("confirm")){const{isConfirmed:S}=await B.fire({title:"Actualizar estado",text:`Â¿EstÃ¡s seguro de actualizar la venta al estado "${o.text()}"?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Si, actualizar",cancelButtonText:"Cancelar"});if(!S)return}const h=await R.save({id:t.id,status_id:s});h&&(a(h.data),$(i.current).dxDataGrid("instance").refresh())},_=async n=>{const{isConfirmed:s}=await B.fire({title:"Anular pedido",text:"Â¿Estas seguro de anular este pedido?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, anular",cancelButtonText:"Cancelar"});!s||!await R.delete(n)||$(i.current).dxDataGrid("instance").refresh()},b=async n=>{j([]);const s=await R.get(n);a(s),$(c.current).modal("show")};y.useEffect(()=>{t&&Q.bySale(t.id).then(n=>{j(n||[])})},[t]);const w=Number(t==null?void 0:t.amount)+Number(t==null?void 0:t.delivery)-Number(t==null?void 0:t.bundle_discount)-Number(t==null?void 0:t.renewal_discount)-Number(t==null?void 0:t.coupon_discount),u=t!=null&&t.phone.clean("0-9").startsWith("51")?t==null?void 0:t.phone.clean("0-9"):`51${t==null?void 0:t.phone.clean("0-9")}`;return e.jsxs(e.Fragment,{children:[e.jsx(U,{gridRef:i,title:"Pedidos",rest:R,toolBar:n=>{n.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(i.current).dxDataGrid("instance").refresh()}})},exportable:!0,pageSize:25,columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"code",caption:"Numero de orden",visible:!1},{dataField:"fullname",caption:"Orden",width:"250px",cellTemplate:(n,{data:s})=>{n.css("cursor","pointer"),n.on("click",()=>{b(s.id)}),O(n,e.jsxs("p",{className:"mb-0",style:{width:"100%"},children:[e.jsxs("b",{className:"d-block w-100 text-truncate",children:[s.renewal&&e.jsx(T,{content:`Plan: ${s.renewal.name}`,children:e.jsx("i",{className:"fa fas fa-spa text-pink me-1"})}),s.name," ",s.lastname]}),e.jsxs("small",{className:"text-nowrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,fontFamily:"monospace"},children:["#",F.APP_CORRELATIVE,"-",s.code]})]}))}},{dataField:"phone",caption:"TelÃ©fono",width:"120px",cellTemplate:(n,{data:s})=>{n.text(s.phone.keep("0-9"))}},{dataField:"email",caption:"Email"},{dataField:"department",caption:"Departamento"},{dataField:"province",caption:"Ciudad",cellTemplate:(n,{data:s})=>{n.text(s.province||s.district)}},{dataField:"created_at",caption:"Fecha",dataType:"date",sortOrder:"desc",width:"150px",cellTemplate:(n,{data:s})=>{n.html(q(e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"d-block",children:moment(s.created_at.replace("Z","-05:00")).fromNow()}),e.jsx("small",{className:"d-block text-muted",children:moment(s.created_at).format("lll")})]})))}},{dataField:"status.name",caption:"Estado",width:"100px",cellTemplate:(n,{data:s})=>{O(n,e.jsx(e.Fragment,{children:e.jsx(T,{content:s.status.description,children:e.jsx("span",{className:"d-block mx-auto badge rounded-pill",style:{backgroundColor:s.status.color?`${s.status.color}2e`:"#3333332e",color:s.status.color??"#333",width:"max-content",marginBottom:"4px"},children:s.status.name})})}))}},{dataField:"total_amount",caption:"Total",dataType:"number",width:"100px",cellTemplate:(n,{data:s})=>{n.text(`S/. ${m(s.total_amount)}`)}},{caption:"Acciones",cellTemplate:(n,{data:s})=>{n.append(P({className:"btn btn-xs btn-light",title:"Ver pedido",icon:"fa fa-eye",onClick:()=>b(s.id)})),!s.status.confirm&&n.append(P({className:"btn btn-xs btn-soft-danger",title:"Anular pedido",icon:"fa fa-trash",onClick:()=>_(s.id)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(H,{modalRef:c,title:`Detalles del pedido #${F.APP_CORRELATIVE}-${t==null?void 0:t.code}`,size:"xl",bodyStyle:{backgroundColor:"#ebeff2"},hideButtonSubmit:!0,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Detalles de Venta"})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsx("table",{id:"table-info",className:"table table-borderless table-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Nombres:"}),e.jsxs("td",{children:[t==null?void 0:t.name," ",t==null?void 0:t.lastname]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Email:"}),e.jsx("td",{children:t==null?void 0:t.email})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"TelÃ©fono:"}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-1 align-items-center",children:[e.jsx("img",{className:"avatar-sm rounded-circle",src:`${F.WA_URL}/api/profile/${F.APP_CORRELATIVE}/${u}`,onError:n=>{n.target.onerror=null,n.target.src="/api/admin/profile/thumbnail/undefined"},alt:(t==null?void 0:t.name)+" "+(t==null?void 0:t.lastname)}),e.jsxs("div",{children:[e.jsx("span",{className:"d-block",children:t==null?void 0:t.phone}),e.jsx("a",{href:`//wa.me/${u}`,target:"_blank",children:e.jsxs("small",{children:["Abrir WhatsApp ",e.jsx("i",{className:"mdi mdi-arrow-top-right"})]})})]})]})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"DirecciÃ³n:"}),e.jsxs("td",{children:[t==null?void 0:t.address," ",t==null?void 0:t.number,e.jsxs("small",{className:"text-muted d-block",children:[(t==null?void 0:t.province)??(t==null?void 0:t.district),", ",t==null?void 0:t.department,", ",t==null?void 0:t.country," ",(t==null?void 0:t.zip_code)&&e.jsxs(e.Fragment,{children:["- ",t==null?void 0:t.zip_code]})]})]})]}),(t==null?void 0:t.reference)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Referencia:"}),e.jsx("td",{children:t==null?void 0:t.reference})]}),(t==null?void 0:t.comment)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Comentario:"}),e.jsx("td",{children:t==null?void 0:t.comment})]}),(t==null?void 0:t.billing_type)&&(t==null?void 0:t.billing_number)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Comprobante:"}),e.jsxs("td",{children:[e.jsx("b",{className:"d-block",children:t.billing_type.toTitleCase()}),e.jsxs("small",{children:[e.jsx("code",{className:"me-1",children:t.billing_type=="boleta"?"DNI":"RUC"}),e.jsx("span",{children:t==null?void 0:t.billing_number})]})]})]})]})}),e.jsxs("button",{className:"btn btn-xs btn-dark",type:"button",copy:`Nombres: ${t==null?void 0:t.fullname}
Email: ${t==null?void 0:t.email}
TelÃ©fono: ${t==null?void 0:t.phone}
DirecciÃ³n: ${t==null?void 0:t.address} ${t==null?void 0:t.number}
_${(t==null?void 0:t.province)??(t==null?void 0:t.district)}, ${t==null?void 0:t.department}, ${t==null?void 0:t.country} ${t!=null&&t.zip_code?`- ${t==null?void 0:t.zip_code}`:""}_`,children:[e.jsx("i",{className:"mdi mdi-content-copy me-1"}),"Copiar"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"ArtÃ­culos"})}),e.jsx("div",{className:"card-body p-2 table-responsive",children:e.jsxs("table",{className:"table table-striped table-bordered table-sm table-hover mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Colores"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Subtotal"})]})}),e.jsx("tbody",{children:(N=t==null?void 0:t.details)==null?void 0:N.map((n,s)=>{var h;const o=n.quantity*100/100,g=n.price*n.quantity;return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("span",{className:"d-block",children:n.name}),n.user_formula_id&&n.user_formula_id!=t.user_formula_id&&e.jsx(T,{content:e.jsx(z,{name:t==null?void 0:t.name,details:t==null?void 0:t.details,formula:n.user_formula}),allowHTML:!0,interactive:!0,children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"mdi mdi-flask me-1"}),"FÃ³rmula secundaria"]})})]}),e.jsx("td",{children:(h=n==null?void 0:n.colors)==null?void 0:h.map((S,I)=>e.jsx(T,{content:S.name,children:e.jsx("i",{className:"mdi mdi-circle",style:{color:S.hex,WebkitTextStroke:"1px #808080"}})},I))}),e.jsxs("td",{align:"right",children:["S/ ",m(n.price)]}),e.jsx("td",{align:"center",children:o}),e.jsxs("td",{align:"right",children:["S/ ",m(g)]})]},s)})})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Resumen"})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Subtotal:"}),e.jsxs("span",{children:["S/ ",m(t==null?void 0:t.amount)]})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"EnvÃ­o:"}),e.jsxs("span",{children:["S/ ",m(t==null?void 0:t.delivery)]})]}),(t==null?void 0:t.bundle)&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("b",{children:["Descuento x paquete:",e.jsxs("small",{className:"d-block text-muted",style:{fontWeight:"lighter"},children:["Elegiste ",(f=t==null?void 0:t.bundle)==null?void 0:f.name," (-",((r=t==null?void 0:t.bundle)==null?void 0:r.percentage)*1e4/100,"%)"]})]}),e.jsxs("span",{children:["S/ -",m(t==null?void 0:t.bundle_discount)]})]}),(t==null?void 0:t.renewal)&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("b",{children:["SubscripciÃ³n:",e.jsxs("small",{className:"d-block text-muted",style:{fontWeight:"lighter"},children:[(x=t==null?void 0:t.renewal)==null?void 0:x.name," (-",((p=t==null?void 0:t.renewal)==null?void 0:p.percentage)*1e4/100,"%)"]})]}),e.jsxs("span",{children:["S/ -",m(t==null?void 0:t.renewal_discount)]})]}),(t==null?void 0:t.coupon)&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("b",{children:["CupÃ³n aplicado:",e.jsxs("small",{className:"d-block text-muted",style:{fontWeight:"lighter"},children:[(C=t==null?void 0:t.coupon)==null?void 0:C.name," (-",((E=t==null?void 0:t.coupon)==null?void 0:E.amount)*100/100,"%)"]})]}),e.jsxs("span",{children:["S/ -",m(t==null?void 0:t.coupon_discount)]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Total:"}),e.jsx("span",{children:e.jsxs("strong",{children:["S/ ",m(w)]})})]})]})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Formula principal"})}),e.jsx("div",{className:"card-body p-2",children:e.jsx(z,{name:t==null?void 0:t.name,details:t==null?void 0:t.details,formula:t==null?void 0:t.formula})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Estado"})}),e.jsx("div",{className:"card-body p-2",children:e.jsxs("div",{className:"",children:[e.jsx("label",{htmlFor:"statusSelect",className:"form-label",children:"Estado Actual"}),e.jsx("select",{className:"form-select",id:"statusSelect",value:t==null?void 0:t.status_id,onChange:v,disabled:!((A=t==null?void 0:t.status)!=null&&A.reversible),children:l.map((n,s)=>e.jsx("option",{value:n.id,"data-confirm":!!n.confirm,children:n.name},s))})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Cambios de Estado"})}),e.jsx("div",{className:"card-body p-2 d-flex flex-column gap-1",style:{maxHeight:"300px",overflowY:"auto"},children:d==null?void 0:d.map((n,s)=>{var o,g,h;return e.jsxs("article",{className:"border py-1 px-2 ms-3",style:{position:"relative",borderRadius:"16px 4px 4px 16px",backgroundColor:n.status.color?`${n.status.color}2e`:"#3333332e"},children:[e.jsx("i",{className:"mdi mdi-circle left-2",style:{color:n.status.color||"#333",position:"absolute",left:"-25px",top:"50%",transform:"translateY(-50%)"}}),e.jsx("b",{style:{color:n.status.color||"#333"},children:(o=n==null?void 0:n.status)==null?void 0:o.name}),e.jsxs("small",{className:"d-block text-truncate",children:[(g=n==null?void 0:n.user)==null?void 0:g.name," ",(h=n==null?void 0:n.user)==null?void 0:h.lastname]}),e.jsx("small",{className:"d-block text-muted",children:moment(n.created_at).format("YYYY-MM-DD HH:mm")})]},s)})})]})]})]})})]})};Z((l,i)=>{V(l).render(e.jsx(G,{...i,title:"Pedidos",children:e.jsx(X,{...i})}))});
