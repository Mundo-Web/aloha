var le=Object.defineProperty;var oe=(u,i,j)=>i in u?le(u,i,{enumerable:!0,configurable:!0,writable:!0,value:j}):u[i]=j;var ee=(u,i,j)=>(oe(u,typeof i!="symbol"?i+"":i,j),j);import{j as e}from"./AboutHeader-DEdD30eg.js";import{i as I,B as me}from"./Base-DXXGQT4E.js";import{r as f}from"./index-RYns6xqu.js";import{c as de}from"./ReactAppend-vpV7VTGG.js";import{S as ne}from"./sweetalert2.all-DJo0UVK6.js";import{m as se}from"./main-BjVPLcVK.js";import{B as ue}from"./BasicRest-Dts8qu_l.js";import{S as ce}from"./SalesRest-CjAnAtP7.js";import{M as pe}from"./Modal-DV4omerP.js";import{T as he}from"./Table-Bi4FivVB.js";import{D as re}from"./DxButton-CsjWvhyj.js";import{C as xe,G as Q}from"./CreateReactScript-CXQforvT.js";import{N as x}from"./Number2Currency-e57Tgsuk.js";import{R as te}from"./ReactAppend-DPXaoPQG.js";import{M as je}from"./Modal-rZoicGxC.js";import{S as Z}from"./SelectFormGroup-DQ56H9li.js";import{r as be}from"./server.browser-D0dT10Bs.js";import{I as _}from"./InputFormGroup-Q4dtQxWB.js";import{T as ie}from"./TextareaFormGroup-Col4R6C6.js";import{C as ge}from"./CouponsRest-B3_jfIBN.js";import"./index-CXU7o9CY.js";/* empty css              */import"./index.esm-Bla6j_hB.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./WhatsAppModal-CqtV5vQS.js";/* empty css               */class ve extends ue{constructor(){super(...arguments);ee(this,"path","admin/sale-statuses");ee(this,"bySale",async j=>{try{const{status:N,result:C}=await se.Fetch(`/api/${this.path}/by-sale/${j}`);if(!N)throw new Error((C==null?void 0:C.message)||"Ocurrio un error inesperado");return C.data}catch(N){return se.Notify.add({icon:"/assets/img/favicon.png",title:"Error",body:N.message,type:"danger"}),null}})}}const ae=({name:u,formula:i,details:j})=>{var C,q,D,P,y,l,d,t,b,w,k,g;const N=j==null?void 0:j.filter(m=>!m.user_formula_id||m.user_formula_id==i.id);return e.jsxs(e.Fragment,{children:[i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("b",{children:"ðŸ§ Tratamiento"}),":"," ",(C=i==null?void 0:i.has_treatment)==null?void 0:C.description]}),e.jsxs("div",{children:[e.jsx("b",{children:"ðŸ‘€ Cuero cabelludo"}),": "," ",(q=i==null?void 0:i.scalp_type)==null?void 0:q.description]}),e.jsxs("div",{children:[e.jsx("b",{children:"âœ… Tipo de cabello"}),":"," ",(D=i==null?void 0:i.hair_type)==null?void 0:D.description]}),(i==null?void 0:i.hair_thickness)&&e.jsxs("div",{children:[e.jsx("b",{children:"ðŸ’ª Grosor del cabello"}),":"," ",(P=i==null?void 0:i.hair_thickness)==null?void 0:P.description]}),e.jsxs("div",{children:[e.jsx("b",{children:"ðŸ’¡ Objetivos"}),":"," ",e.jsx("ul",{className:"mb-0",children:(y=i==null?void 0:i.hair_goals_list)==null?void 0:y.map(m=>e.jsx("li",{children:m.description},m.id))})]}),e.jsxs("div",{children:[e.jsx("b",{children:"ðŸ«™ Fragancia"}),":"," ",(l=i==null?void 0:i.fragrance)==null?void 0:l.name]})]}),e.jsxs("div",{children:[e.jsx("b",{children:"ðŸŽ¨ Colores:"}),e.jsx("ul",{children:N==null?void 0:N.map((m,T)=>{var F,v;return e.jsxs("li",{children:[m.name,((F=m==null?void 0:m.colors)==null?void 0:F.length)>0&&e.jsxs(e.Fragment,{children:[": ",(v=m==null?void 0:m.colors)==null?void 0:v.map(S=>S.name).join(", ")]})]},T)})})]}),e.jsxs("button",{className:"btn btn-xs btn-dark",type:"button",copy:`${i?`*Formula ${u}*

ðŸ§ Tratamiento: ${(d=i==null?void 0:i.has_treatment)==null?void 0:d.description}
ðŸ‘€ Cuero cabelludo: ${(t=i==null?void 0:i.scalp_type)==null?void 0:t.description}
âœ… Tipo de cabello: ${(b=i==null?void 0:i.hair_type)==null?void 0:b.description}
${i!=null&&i.hair_thickness?`ðŸ’ª Grosor del cabello: ${(w=i==null?void 0:i.hair_thickness)==null?void 0:w.description}
`:""}ðŸ’¡ Objetivos:
${(k=i==null?void 0:i.hair_goals_list)==null?void 0:k.map(m=>`- ${m.description}`).join(`
`)}
ðŸ«™ Fragancia: ${(g=i==null?void 0:i.fragrance)==null?void 0:g.name}
`:`*Pedido ${u}*

`}ðŸŽ¨ Colores:
${N==null?void 0:N.map(m=>{var T,F;return`- ${m.name}${((T=m==null?void 0:m.colors)==null?void 0:T.length)>0?`: ${(F=m==null?void 0:m.colors)==null?void 0:F.map(v=>v.name).join(", ")}`:""}`}).join(`
`)}`,children:[e.jsx("i",{className:"mdi mdi-content-copy me-1"}),"Copiar"]})]})},Ne={name:"Lima Metropolitana",delivery:"Gratis",items:["Ate","Barranco","BreÃ±a","Cercado de Lima","Chorrillos","Comas","El Agustino","Independencia","JesÃºs MarÃ­a","La Molina","La Victoria","Lince","Los Olivos","Magdalena del Mar","Miraflores","Pueblo Libre","RÃ­mac","San Borja","San Isidro","San Juan de Lurigancho","San Juan de Miraflores","San Luis","San Martin de Porres","San Miguel","Santa Anita","Santiago de Surco","Surquillo","Villa el Salvador","Villa Maria del Triunfo"]},ye={name:"Lima Alrededores",delivery:"Por Shalom - Pago en destino",items:["AncÃ³n","Carabayllo","Chaclacayo","Cieneguilla","LurÃ­n","PachacÃ¡mac","Pucusana","Puente Piedra","Punta Hermosa","Punta Negra","San Bartolo","Lurigancho (Chosica)","Santa MarÃ­a del Mar","Santa Rosa"]},fe={name:"Provincias",delivery:"Por Shalom - Pago en destino",items:""},h={metropolitana:Ne,alrededores:ye,provincias:fe},Ce=new ge,_e=new ce,Se=({modalRef:u,gridRef:i,items:j,phone_prefixes:N=[],bundles:C,free_shipping:q,free_shipping_minimum_amount:D,free_shipping_amount:P,free_shipping_zones:y})=>{var G,r,a;u||(u=f.useRef());const[l,d]=f.useState({billing_type:"boleta",phone_prefix:"51",billing_number:"",email:"",phone:"",origin:"",origin_comment:"",department:"",province:"",zip_code:"",address:"",number:"",reference:"",comment:"",name:"",lastname:"",country:"",department_code:"",district:"",coupon:"",amount_discount:0}),[t,b]=f.useState([]),[w,k]=f.useState(""),[g,m]=f.useState(null),T=n=>{const s=n.reduce((o,p)=>o+p.quantity,0);return C.find(o=>{switch(o.comparator){case"<":return s<o.items_quantity;case">":return s>o.items_quantity;default:return s==o.items_quantity}})},F=(n,s)=>{if(!n)return 0;const c=Number(n.amount)||0;return n.type=="fixed_amount"?c:n.type=="percentage"?(s-A)*c/100:0},v=t.reduce((n,s)=>n+s.price*s.quantity,0),S=T(t),A=v*((S==null?void 0:S.percentage)||0),M=F(g,v);let E=0;if(q=="true")for(const n of y.split(","))v-A>=D?(h[n].delivery="Gratis",E=0):(h[n].delivery=`S/ ${x(P)}`,E=Number(P));const z=Number(l.amount_discount)||0,O=v-A-M-z+E,W=(n,s)=>{const c=[...t],o=c[n];o.colors.push(s),o.quantity=o.colors.length,b(c)},V=(n,s)=>{const c=[...t],o=c[n];o.colors=o.colors.filter(p=>p.id!==s),o.quantity=o.colors.length,b(c)},Y=(n,s)=>{const c=[...t],o=c[n];o.quantity=s,b(c)},H=async()=>{const n=await Ce.save({coupon:w,amount:v,email:l.email});m(n?n.data:null)},U=()=>{let n="Lima",s="Lima",c=null;return Array.isArray(h[l.department].items)?(n=h[l.department].name,s=l.province,c=null):(n=l.province,s=null,c=l.district),{...l,country:"PerÃº",department_code:l.department,department:n,province:s,district:c}},K=async n=>{if(n.preventDefault(),t.filter(p=>p.quantity>0).length==0){ne.fire({icon:"warning",title:"No hay productos en la venta",text:"Debe agregar al menos un producto a la venta"});return}const c={sale:{...U(),coupon:(g==null?void 0:g.name)||null},details:t};await _e.pos(c)&&($(i.current).dxDataGrid("instance").refresh(),$(u.current).modal("hide"))},B=n=>{if(!n.id)return n.text;const s=n.element.dataset.code,c=n.element.dataset.flag,o=n.element.dataset.country,p=be(e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-emoji text-center",children:c}),e.jsx("b",{className:"ms-1",children:s}),e.jsx("small",{className:"d-block text-truncate",children:o})]}));return $(p)},J=()=>{d({billing_type:"boleta",phone_prefix:"51",billing_number:"",email:"",phone:"",origin:"",origin_comment:"",department:"",province:"",zip_code:"",address:"",number:"",reference:"",comment:"",name:"",lastname:"",country:"",department_code:"",district:"",coupon:"",amount_discount:0}),b(j.filter(({is_default:n})=>n).map(n=>({id:n.id,name:n.name,price:n.price,colors:[],quantity:0}))),k(""),m(null)};return f.useEffect(()=>($(u.current).on("shown.bs.modal",()=>{J()}),()=>{$(u.current).off("shown.bs.modal")}),[]),e.jsxs(je,{id:"new-sale-modal",modalRef:u,title:"Nueva venta",size:"lg",isStatic:!0,hideFooter:!0,onSubmit:K,children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("h4",{className:"mt-0",children:"InformaciÃ³n del cliente"}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{className:"form-label",children:["Tipo de comprobante ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col-6",children:e.jsx("label",{htmlFor:"billing_type_boleta",className:"card border mb-0",children:e.jsxs("div",{className:"card-body p-1 px-2 d-flex align-items-center  gap-1",children:[e.jsx("input",{type:"radio",className:"form-check-input",name:"billing_type",id:"billing_type_boleta",value:"boleta",style:{marginTop:"-2px"},checked:l.billing_type==="boleta",onChange:n=>d(s=>({...s,billing_type:n.target.value})),required:!0}),e.jsxs("span",{className:"d-flex align-items-center justify-content-center gap-1",htmlFor:"billing_type_boleta",children:[e.jsx("i",{className:"mdi mdi-account font-18"}),e.jsx("span",{children:"Boleta"})]})]})})}),e.jsx("div",{className:"col-6",children:e.jsx("label",{htmlFor:"billing_type_factura",className:"card border mb-0",children:e.jsxs("div",{className:"card-body p-1 px-2 d-flex align-items-center gap-1",children:[e.jsx("input",{type:"radio",className:"form-check-input",name:"billing_type",id:"billing_type_factura",value:"factura",style:{marginTop:"-2px"},checked:l.billing_type==="factura",onChange:n=>d(s=>({...s,billing_type:n.target.value})),required:!0}),e.jsxs("span",{className:"d-flex align-items-center justify-content-center gap-1",htmlFor:"billing_type_factura",children:[e.jsx("i",{className:"mdi mdi-office-building font-18"}),e.jsx("span",{children:"Factura"})]})]})})})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{className:"form-label",htmlFor:"billing_number",children:["Documento ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"billing_number",className:"form-control",value:l.billing_number||"",maxLength:l.billing_type==="boleta"?8:11,minLength:l.billing_type==="boleta"?8:11,required:!0,onChange:n=>{const s=n.target.value.replace(/\D/g,"");d(c=>({...c,billing_number:s}))}})]}),e.jsxs("div",{className:"row",children:[e.jsx(_,{label:"Nombres",col:"col-md-6",value:l.name,onChange:n=>d(s=>({...s,name:n.target.value})),required:!0}),e.jsx(_,{label:"Apellidos",col:"col-md-6",value:l.lastname,onChange:n=>d(s=>({...s,lastname:n.target.value})),required:!0})]}),e.jsx(_,{label:"Email",type:"email",value:l.email,onChange:n=>d(s=>({...s,email:n.target.value})),required:!0}),e.jsx("label",{htmlFor:"",className:"form-label",children:"Celular"}),e.jsxs("div",{className:"row",children:[e.jsx(Z,{col:"col-md-4",dropdownParent:"#new-sale-modal",minimumInputLength:-1,templateResult:B,templateSelection:B,value:l.phone_prefix,onChange:n=>d(s=>({...s,phone_prefix:n.target.value})),children:N.sort((n,s)=>n.country.localeCompare(s.country)).map((n,s)=>e.jsxs("option",{value:n.realCode,"data-code":n.beautyCode,"data-flag":n.flag,"data-country":n.country,children:[n.beautyCode," ",n.country]},s))}),e.jsx(_,{col:"col-md-8",type:"tel",value:l.phone,onChange:n=>{const s=n.target.value.replace(/\D/g,"");d(c=>({...c,phone:s}))}})]}),e.jsx("div",{className:"mb-2",children:e.jsxs(Z,{label:"Origen de venta",minimumResultsForSearch:-1,dropdownParent:"#new-sale-modal",value:l.origin,onChange:n=>d(s=>({...s,origin:n.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Elige una opciÃ³n"}),e.jsx("option",{value:"Banner",children:"Banner publicitario"}),e.jsx("option",{value:"Facebook",children:"Facebook"}),e.jsx("option",{value:"Instagram",children:"Instagram"}),e.jsx("option",{value:"WhatsApp",children:"WhatsApp"}),e.jsx("option",{value:"TikTok",children:"TikTok"}),e.jsx("option",{value:"Recompra",children:"Recompra"}),e.jsx("option",{value:"Instagram recompra",children:"Instagram recompra"}),e.jsx("option",{value:"WhatsApp recompra",children:"WhatsApp recompra"}),e.jsx("option",{value:"Cancelado",children:"Cancelado"})]})}),e.jsx(ie,{label:"Comentario interno",value:l.origin_comment,onChange:n=>d(s=>({...s,origin_comment:n.target.value})),placeholder:"Ingresa un comentario sobre por quÃ© se estÃ¡ creando esta venta..."})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("h4",{className:"mt-0",children:"DirecciÃ³n del cliente"}),e.jsx(_,{label:"Pais",value:"PerÃº",disabled:!0,required:!0}),e.jsxs(Z,{label:"RegiÃ³n / Provincia",value:l.department||"",onChange:n=>d(s=>({...s,department:n.target.value})),minimumResultsForSearch:-1,dropdownParent:"#new-sale-modal",required:!0,children:[e.jsx("option",{value:"",children:"Elige una opciÃ³n"}),Object.keys(h).map((n,s)=>e.jsx("option",{value:n,children:h[n].name},s))]}),h[l.department]&&e.jsxs("div",{className:"row",children:[Array.isArray(h[l.department].items)?e.jsxs(Z,{label:"Provincia",col:"col-md-8",dropdownParent:"#new-sale-modal",value:l.province,effectWith:[l.department],onChange:n=>d(s=>({...s,province:n.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Elige una opciÃ³n"}),h[l.department].items.map((n,s)=>e.jsx("option",{value:n,children:n},s))]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{label:"Departamento",col:"col-md-4",value:l.province,onChange:n=>d(s=>({...s,province:n.target.value})),required:!0}),e.jsx(_,{label:"Distrito",col:"col-md-4",value:l.district,onChange:n=>d(s=>({...s,district:n.target.value})),required:!0})]}),e.jsx(_,{label:"CÃ³d. Postal",col:"col-md-4",value:l.zip_code,onChange:n=>d(s=>({...s,zip_code:n.target.value}))})]}),e.jsxs("div",{className:"row",children:[e.jsx(_,{label:"DirecciÃ³n",col:"col-md-8",value:l.address,onChange:n=>d(s=>({...s,address:n.target.value})),required:!0}),e.jsx(_,{label:"NÃºmero",col:"col-md-4",type:"number",value:l.number,onChange:n=>d(s=>({...s,number:n.target.value})),required:!0})]}),e.jsx(_,{label:"Apartamento, habitaciÃ³n, piso, etc.",value:l.reference,onChange:n=>d(s=>({...s,reference:n.target.value}))}),e.jsx(ie,{label:"Notas del pedido",value:l.comment,placeholder:"Notas sobre el pedido, por ejemplo, notas especiales para la entrega.",onChange:n=>d(s=>({...s,comment:n.target.value}))})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"mb-0",children:"Productos"}),e.jsx("small",{className:"text-muted",children:"Selecciona los productos que deseas agregar a la compra"})]}),e.jsx("div",{className:"product-selection mb-1",children:e.jsx("div",{className:"row",children:j.map(n=>{const s=t.some(c=>c.id===n.id);return e.jsx("div",{className:"col-sm-6 col-md-3 mb-2",children:e.jsx("div",{className:`card mb-0 h-100 cursor-pointer shadow-lg ${s?"border border-primary":""}`,onClick:()=>{if(!s)b([...t,{id:n.id,name:n.name,price:n.price,colors:[],quantity:0}]);else{const c=[...t];c.splice(c.findIndex(o=>o.id===n.id),1),b(c)}},children:e.jsxs("div",{className:"card-body p-2",children:[e.jsx("h5",{className:`card-title mt-0 mb-0 ${s?"text-primary":""}`,children:n.name}),e.jsxs("small",{className:"card-text text-muted",children:["S/ ",n.price||79.9]})]})})},n.id)})})}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-centered table-nowrap table-bordered table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Color"}),e.jsx("th",{style:{width:"92px"},children:"Cant."}),e.jsx("th",{style:{width:"88px"},children:"Precio"}),e.jsx("th",{style:{width:"88px"},children:"Subtotal"})]})}),e.jsx("tbody",{children:t.map((n,s)=>{const c=j.find(p=>p.id===n.id),o=(c==null?void 0:c.colors)||[];return e.jsxs("tr",{children:[e.jsx("td",{children:(c==null?void 0:c.name)||"Producto no encontrado"}),e.jsx("td",{style:{width:"240px"},children:e.jsx("div",{className:"d-flex flex-wrap gap-1",children:o.map(p=>{const X=n.colors.filter(L=>L.id===p.id).length;return e.jsx(I,{content:p.name,children:e.jsxs("div",{onClick:()=>W(s,p),className:"position-relative cursor-pointer",children:[e.jsx("div",{className:`rounded-circle position-relative p-2 border ${X>0?"border-primary":""}`,style:{backgroundColor:p.hex}}),X>0&&e.jsx("small",{className:"position-absolute translate-middle badge rounded-pill bg-primary",onClick:L=>{L.stopPropagation(),V(s,p.id)},style:{padding:"2px 4px",top:"4px",fontSize:"10px",right:"-12px"},children:X})]})},p.id)})})}),e.jsx("td",{children:o.length==0?e.jsx("input",{className:"form-control form-control-sm",type:"number",style:{width:"75px"},value:n.quantity,onChange:p=>Y(s,p.target.value)}):n.quantity}),e.jsxs("td",{className:"text-end",children:["S/ ",n.price]}),e.jsxs("td",{className:"text-end",children:["S/ ",(n.price*n.quantity).toFixed(2)]})]},s)})}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end",children:"Subtotal:"}),e.jsxs("td",{className:"text-end",children:["S/ ",v.toFixed(2)]})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end",children:"Descuento interno:"}),e.jsx("td",{className:"text-end p-0",children:e.jsxs("div",{className:"input-group input-group-sm flex-nowrap",children:[e.jsx("span",{className:"input-group-text",children:"S/ "}),e.jsx("input",{type:"number",className:"form-control form-control-sm",style:{width:"100px"},value:l.amount_discount,onChange:n=>d({...l,amount_discount:n.target.value})})]})})]}),S&&e.jsxs("tr",{children:[e.jsxs("td",{colSpan:4,className:"text-end",children:[e.jsx("span",{className:"d-block",children:"Descuento por paquete"}),e.jsxs("small",{className:"text-muted -mt-1",children:["Escogiste un ",S.name," (",(S.percentage*100).toFixed(2),"%)"]})]}),e.jsxs("td",{className:"text-end",children:["S/ -",x(Math.round(A*10)/10)]})]}),g&&e.jsxs("tr",{children:[e.jsxs("td",{colSpan:4,className:"text-end",children:[e.jsxs("span",{className:"d-block",children:["CupÃ³n aplicado",e.jsx(I,{content:"Eliminar",children:e.jsx("i",{className:"text-danger mdi mdi-close cursor-pointer ms-1",onClick:()=>m(null)})})]}),e.jsxs("small",{className:"text-muted",children:[g.name," (",g.type=="fixed_amount"?`S/ -${x(g.amount)}`:`-${Math.round(g.amount*100)/100}%`,")"]})]}),e.jsxs("td",{className:"text-end",children:["S/ -",x(Math.round(M*10)/10)]})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end",children:"EnvÃ­o:"}),e.jsx("td",{className:"text-end",children:typeof((G=h==null?void 0:h[l.department])==null?void 0:G.delivery)=="number"?`S/ ${x((r=h==null?void 0:h[l.department])==null?void 0:r.delivery)}`:(a=h==null?void 0:h[l.department])==null?void 0:a.delivery})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end",children:"Total:"}),e.jsxs("td",{className:"text-end",children:["S/ ",x(Math.round(O*10)/10)]})]})]})]})})]})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:!g&&e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"CÃ³digo de cupÃ³n",value:w,onChange:n=>k(n.target.value)}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:H,children:"Aplicar cupÃ³n"})]})}),e.jsx("div",{className:"col-md-6 text-end",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Guardar venta"})})]})]})},R=new ce,we=new ve,$e=({statuses:u,items:i,phone_prefixes:j,bundles:N,free_shipping:C,free_shipping_minimum_amount:q,free_shipping_amount:D,free_shipping_zones:P})=>{var M,E,z,O,W,V,Y,H,U,K,B,J,G;const y=f.useRef(),l=f.useRef(),d=f.useRef(),[t,b]=f.useState(null),[w,k]=f.useState([]),g=async r=>{const a=r.target.value,n=$(r.target).find(`option[value="${a}"]`);if(n.data("confirm")){const{isConfirmed:o}=await ne.fire({title:"Actualizar estado",text:`Â¿EstÃ¡s seguro de actualizar la venta al estado "${n.text()}"?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Si, actualizar",cancelButtonText:"Cancelar"});if(!o)return}const c=await R.save({id:t.id,status_id:a});c&&(b(c.data),$(y.current).dxDataGrid("instance").refresh())},m=async r=>{const a=r.target.value,n=await R.save({id:t.id,courier:a});n&&(b(n.data),$(y.current).dxDataGrid("instance").refresh())},T=async r=>{const a=r.target.value,n=await R.save({id:t.id,pickup:a});n&&(b(n.data),$(y.current).dxDataGrid("instance").refresh())},F=async r=>{const{isConfirmed:a}=await ne.fire({title:"Anular pedido",text:"Â¿Estas seguro de anular este pedido?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, anular",cancelButtonText:"Cancelar"});!a||await R.delete(r)},v=async r=>{k([]);const a=await R.get(r);b(a),$(l.current).modal("show")};f.useEffect(()=>{t&&(we.bySale(t.id).then(r=>{k(r||[])}),$("#pickupAmountInput").val((t==null?void 0:t.pickup_amount)??0),$("#courierAmountInput").val((t==null?void 0:t.courier_amount)??0))},[t]);const S=async()=>{const r=$("#courierAmountInput").val(),a=$("#pickupAmountInput").val(),n=await R.save({id:t.id,courier_amount:r,pickup_amount:a});n&&(b(n.data),$(y.current).dxDataGrid("instance").refresh())},A=t!=null&&t.phone.clean("0-9").startsWith("51")?t==null?void 0:t.phone.clean("0-9"):`51${t==null?void 0:t.phone.clean("0-9")}`;return e.jsxs(e.Fragment,{children:[e.jsx(he,{gridRef:y,title:"Pedidos",rest:R,toolBar:r=>{r.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(y.current).dxDataGrid("instance").refresh()}}),r.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"Agrega una venta manual",text:"Nueva venta",onClick:()=>$(d.current).modal("show")}})},exportable:!0,pageSize:25,columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"code",caption:"Numero de orden",visible:!1},{dataField:"created_at",caption:"Fecha",dataType:"date",sortOrder:"desc",width:"150px",cellTemplate:(r,{data:a})=>{r.css("cursor","pointer"),r.on("click",()=>{v(a.id)}),te(r,e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"d-block",children:moment(a.created_at.replace("Z","-05:00")).fromNow()}),e.jsx("small",{className:"d-block text-muted",children:moment(a.created_at).format("lll")})]}))}},{dataField:"fullname",caption:"Orden",width:"250px",cellTemplate:(r,{data:a})=>{r.css("cursor","pointer"),r.on("click",()=>{v(a.id)}),te(r,e.jsxs("p",{className:"mb-0",style:{width:"100%"},children:[e.jsxs("b",{className:"d-block w-100 text-truncate",children:[a.renewal&&e.jsx(I,{content:`Plan: ${a.renewal.name}`,children:e.jsx("i",{className:"fa fas fa-spa text-pink me-1"})}),a.name," ",a.lastname]}),e.jsxs("small",{className:"text-nowrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,fontFamily:"monospace"},children:["#",Q.APP_CORRELATIVE,"-",a.code]})]}))}},{dataField:"status.name",caption:"Estado",width:"100px",cellTemplate:(r,{data:a})=>{te(r,e.jsx(e.Fragment,{children:e.jsx(I,{content:a.status.description,children:e.jsx("span",{className:"d-block mx-auto badge rounded-pill",style:{backgroundColor:a.status.color?`${a.status.color}2e`:"#3333332e",color:a.status.color??"#333",width:"max-content",marginBottom:"4px"},children:a.status.name})})}))}},{dataField:"total_amount",caption:"Total",dataType:"number",width:"100px",cellTemplate:(r,{data:a})=>{r.text(`S/. ${x(a.total_amount)}`)}},{dataField:"phone",caption:"TelÃ©fono",width:"120px",cellTemplate:(r,{data:a})=>{r.text(a.phone.keep("0-9"))}},{dataField:"email",caption:"Email"},{dataField:"department",caption:"Departamento"},{dataField:"province",caption:"Ciudad",cellTemplate:(r,{data:a})=>{r.text(a.province||a.district)}},{dataField:"pickup",caption:"Recogido por",width:"100px"},{dataField:"pickup_amount",caption:"Costo de recogo",dataType:"number",width:"80px",cellTemplate:(r,{data:a})=>{r.text(`S/. ${x(a.pickup_amount)}`)}},{dataField:"courier",caption:"Enviado por"},{dataField:"courier_amount",caption:"Costo de envÃ­o",dataType:"number",width:"80px",cellTemplate:(r,{data:a})=>{r.text(`S/. ${x(a.courier_amount)}`)}},{dataField:"origin",caption:"Origen"},{caption:"Acciones",cellTemplate:(r,{data:a})=>{r.append(re({className:"btn btn-xs btn-light",title:"Ver pedido",icon:"fa fa-eye",onClick:()=>v(a.id)})),!a.status.confirm&&r.append(re({className:"btn btn-xs btn-soft-danger",title:"Anular pedido",icon:"fa fa-trash",onClick:()=>F(a.id)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(pe,{modalRef:l,title:`Detalles del pedido #${Q.APP_CORRELATIVE}-${t==null?void 0:t.code}`,size:"xl",bodyStyle:{backgroundColor:"#ebeff2"},hideButtonSubmit:!0,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Detalles de Venta"})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsx("table",{id:"table-info",className:"table table-borderless table-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Nombres:"}),e.jsxs("td",{children:[t==null?void 0:t.name," ",t==null?void 0:t.lastname]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Email:"}),e.jsx("td",{children:t==null?void 0:t.email})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"TelÃ©fono:"}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-1 align-items-center",children:[e.jsx("img",{className:"avatar-sm rounded-circle",src:`${Q.WA_URL}/api/profile/${Q.APP_CORRELATIVE}/${A}`,onError:r=>{r.target.onerror=null,r.target.src="/api/admin/profile/thumbnail/undefined"},alt:(t==null?void 0:t.name)+" "+(t==null?void 0:t.lastname)}),e.jsxs("div",{children:[e.jsx("span",{className:"d-block",children:t==null?void 0:t.phone}),e.jsx("a",{href:`//wa.me/${A}`,target:"_blank",children:e.jsxs("small",{children:["Abrir WhatsApp ",e.jsx("i",{className:"mdi mdi-arrow-top-right"})]})})]})]})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"DirecciÃ³n:"}),e.jsxs("td",{children:[t==null?void 0:t.address," ",t==null?void 0:t.number,e.jsxs("small",{className:"text-muted d-block",children:[(t==null?void 0:t.province)??(t==null?void 0:t.district),", ",t==null?void 0:t.department,", ",t==null?void 0:t.country," ",(t==null?void 0:t.zip_code)&&e.jsxs(e.Fragment,{children:["- ",t==null?void 0:t.zip_code]})]})]})]}),(t==null?void 0:t.reference)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Referencia:"}),e.jsx("td",{children:t==null?void 0:t.reference})]}),(t==null?void 0:t.comment)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Comentario:"}),e.jsx("td",{children:t==null?void 0:t.comment})]}),(t==null?void 0:t.billing_type)&&(t==null?void 0:t.billing_number)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Comprobante:"}),e.jsxs("td",{children:[e.jsx("b",{className:"d-block",children:t.billing_type.toTitleCase()}),e.jsxs("small",{children:[e.jsx("code",{className:"me-1",children:t.billing_type=="boleta"?"DNI":"RUC"}),e.jsx("span",{children:t==null?void 0:t.billing_number})]})]})]})]})}),e.jsxs("button",{className:"btn btn-xs btn-dark",type:"button",copy:`Nombres: ${t==null?void 0:t.fullname}
Email: ${t==null?void 0:t.email}
TelÃ©fono: ${t==null?void 0:t.phone}
DirecciÃ³n: ${t==null?void 0:t.address} ${t==null?void 0:t.number}${t!=null&&t.zip_code?`
CÃ³digo Postal: ${t==null?void 0:t.zip_code}`:""}
UbicaciÃ³n: ${(t==null?void 0:t.province)??(t==null?void 0:t.district)}, ${t==null?void 0:t.department}, ${t==null?void 0:t.country}${t!=null&&t.reference?`
Referencia: ${t==null?void 0:t.reference}`:""}${t!=null&&t.comment?`
Comentario: ${t==null?void 0:t.comment}`:""}${t!=null&&t.billing_type&&(t!=null&&t.billing_number)?`
Comprobante: ${t.billing_type.toTitleCase()}
${t.billing_type=="boleta"?"DNI":"RUC"}: ${t==null?void 0:t.billing_number}`:""}`,children:[e.jsx("i",{className:"mdi mdi-content-copy me-1"}),"Copiar"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"ArtÃ­culos"})}),e.jsx("div",{className:"card-body p-2 table-responsive",children:e.jsxs("table",{className:"table table-striped table-bordered table-sm table-hover mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Colores"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Subtotal"})]})}),e.jsx("tbody",{children:(M=t==null?void 0:t.details)==null?void 0:M.map((r,a)=>{var c;const n=r.quantity*100/100,s=r.price*r.quantity;return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("span",{className:"d-block",children:r.name}),r.user_formula_id&&r.user_formula_id!=t.user_formula_id&&e.jsx(I,{content:e.jsx(ae,{name:t==null?void 0:t.name,details:t==null?void 0:t.details,formula:r.user_formula}),allowHTML:!0,interactive:!0,children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"mdi mdi-flask me-1"}),"FÃ³rmula secundaria"]})})]}),e.jsx("td",{children:(c=r==null?void 0:r.colors)==null?void 0:c.map((o,p)=>e.jsx(I,{content:o.name,children:e.jsx("i",{className:"mdi mdi-circle",style:{color:o.hex,WebkitTextStroke:"1px #808080"}})},p))}),e.jsxs("td",{align:"right",children:["S/ ",x(r.price)]}),e.jsx("td",{align:"center",children:n}),e.jsxs("td",{align:"right",children:["S/ ",x(s)]})]},a)})})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Resumen"})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Subtotal:"}),e.jsxs("span",{children:["S/ ",x(t==null?void 0:t.amount)]})]}),(t==null?void 0:t.amount_discount)>0&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Descuento interno:"}),e.jsxs("span",{children:["S/ ",x(t==null?void 0:t.amount_discount)]})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"EnvÃ­o:"}),e.jsx("span",{children:(t==null?void 0:t.delivery)===null?"Pago en destino":e.jsxs(e.Fragment,{children:["S/ ",x(t==null?void 0:t.delivery)]})})]}),(t==null?void 0:t.bundle)&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("b",{children:["Descuento x paquete:",e.jsxs("small",{className:"d-block text-muted",style:{fontWeight:"lighter"},children:["Elegiste ",(E=t==null?void 0:t.bundle)==null?void 0:E.name," (-",((z=t==null?void 0:t.bundle)==null?void 0:z.percentage)*1e4/100,"%)"]})]}),e.jsxs("span",{children:["S/ -",x(t==null?void 0:t.bundle_discount)]})]}),(t==null?void 0:t.renewal)&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("b",{children:["SubscripciÃ³n:",e.jsxs("small",{className:"d-block text-muted",style:{fontWeight:"lighter"},children:[(O=t==null?void 0:t.renewal)==null?void 0:O.name," (-",((W=t==null?void 0:t.renewal)==null?void 0:W.percentage)*1e4/100,"%)"]})]}),e.jsxs("span",{children:["S/ -",x(t==null?void 0:t.renewal_discount)]})]}),(t==null?void 0:t.coupon)&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("b",{children:["CupÃ³n aplicado:",e.jsxs("small",{className:"d-block text-muted",style:{fontWeight:"lighter"},children:[(V=t==null?void 0:t.coupon)==null?void 0:V.name," (-",((Y=t==null?void 0:t.coupon)==null?void 0:Y.amount)*100/100,"%)"]})]}),e.jsxs("span",{children:["S/ -",x(t==null?void 0:t.coupon_discount)]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Total:"}),e.jsx("span",{children:e.jsxs("strong",{children:["S/ ",x(t==null?void 0:t.total_amount)]})})]})]})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Formula principal"})}),e.jsx("div",{className:"card-body p-2",children:e.jsx(ae,{name:t==null?void 0:t.name,details:t==null?void 0:t.details,formula:t==null?void 0:t.formula})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Estado"})}),e.jsx("div",{className:"card-body p-2",children:e.jsxs("div",{className:"",children:[e.jsx("label",{htmlFor:"statusSelect",className:"form-label",children:"Estado Actual"}),e.jsx("select",{className:"form-select",id:"statusSelect",value:t==null?void 0:t.status_id,onChange:g,disabled:!((H=t==null?void 0:t.status)!=null&&H.reversible),children:u.map((r,a)=>e.jsx("option",{value:r.id,"data-confirm":!!r.confirm,children:r.name},a))})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header p-2 d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"card-title mb-0",children:"Enviado por"}),e.jsx("button",{className:"btn btn-success btn-xs pull-rigth",disabled:!((U=t==null?void 0:t.status)!=null&&U.reversible),type:"button",onClick:()=>S(),children:"Guardar"})]}),e.jsx("div",{className:"card-body p-2",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("div",{className:"form-group mb-2",children:[e.jsx("label",{htmlFor:"pickupSelect",className:"form-label",children:"Agencia de recojo"}),e.jsxs("select",{className:"form-select",id:"pickupSelect",value:(t==null?void 0:t.pickup)??"",onChange:T,disabled:!((K=t==null?void 0:t.status)!=null&&K.reversible),children:[e.jsx("option",{value:"",children:"- Selecciona -"}),e.jsx("option",{value:"Kamary",children:"Kamary"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"pickupAmountInput",className:"form-label",children:"Costo de recojo"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:"S/"}),e.jsx("input",{type:"number",className:"form-control",id:"pickupAmountInput",disabled:!((B=t==null?void 0:t.status)!=null&&B.reversible)})]})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("div",{className:"form-group mb-2",children:[e.jsx("label",{htmlFor:"courierSelect",className:"form-label",children:"Agencia de envÃ­o"}),e.jsxs("select",{className:"form-select",id:"courierSelect",value:(t==null?void 0:t.courier)??"",onChange:m,disabled:!((J=t==null?void 0:t.status)!=null&&J.reversible),children:[e.jsx("option",{value:"",children:"- Selecciona -"}),e.jsx("option",{value:"Kamary",children:"Kamary"}),e.jsx("option",{value:"Olva",children:"Olva"}),e.jsx("option",{value:"Shalom",children:"Shalom"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"courierAmountInput",className:"form-label",children:"Costo de envÃ­o"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:"S/"}),e.jsx("input",{type:"number",className:"form-control",id:"courierAmountInput",step:.01,disabled:!((G=t==null?void 0:t.status)!=null&&G.reversible)})]})]})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Cambios de Estado"})}),e.jsx("div",{className:"card-body p-2 d-flex flex-column gap-1",style:{maxHeight:"300px",overflowY:"auto"},children:w==null?void 0:w.map((r,a)=>{var s,c,o;const n=`${((s=r.user)==null?void 0:s.name)||""} ${((c=r.user)==null?void 0:c.lastname)||""}`.trim()||"AutomÃ¡tico";return e.jsxs("article",{className:"border py-1 px-2 ms-3",style:{position:"relative",borderRadius:"16px 4px 4px 16px",backgroundColor:r.status.color?`${r.status.color}2e`:"#3333332e"},children:[e.jsx("i",{className:"mdi mdi-circle left-2",style:{color:r.status.color||"#333",position:"absolute",left:"-25px",top:"50%",transform:"translateY(-50%)"}}),e.jsx("b",{style:{color:r.status.color||"#333"},children:(o=r==null?void 0:r.status)==null?void 0:o.name}),e.jsx("small",{className:"d-block text-truncate",children:n}),e.jsx("small",{className:"d-block text-muted",children:moment(r.created_at).format("YYYY-MM-DD HH:mm")})]},a)})})]})]})]})}),e.jsx(Se,{modalRef:d,gridRef:y,items:i,phone_prefixes:j,bundles:N,free_shipping:C,free_shipping_minimum_amount:q,free_shipping_amount:D,free_shipping_zones:P})]})};xe((u,i)=>{de(u).render(e.jsx(me,{...i,title:"Pedidos",children:e.jsx($e,{...i})}))});
