var A=Object.defineProperty;var k=(n,i,c)=>i in n?A(n,i,{enumerable:!0,configurable:!0,writable:!0,value:c}):n[i]=c;var j=(n,i,c)=>(k(n,typeof i!="symbol"?i+"":i,c),c);import{j as r}from"./AboutHeader-DEdD30eg.js";import{r as p}from"./index-RYns6xqu.js";import{c as B}from"./ReactAppend-vpV7VTGG.js";import{B as E,i as w}from"./Base-DXXGQT4E.js";import{C as F}from"./CreateReactScript-CXQforvT.js";import{T as G}from"./Table-Bi4FivVB.js";import{M as I}from"./Modal-DV4omerP.js";import{I as R}from"./InputFormGroup-Q4dtQxWB.js";import{R as y}from"./ReactAppend-DPXaoPQG.js";import{D}from"./DxButton-CsjWvhyj.js";import{T as q}from"./TextareaFormGroup-Col4R6C6.js";import{S as M}from"./SwitchFormGroup-DgkpLnQ-.js";import{S as O}from"./sweetalert2.all-DJo0UVK6.js";import{B as P}from"./BasicRest-Dts8qu_l.js";import"./index-CXU7o9CY.js";/* empty css              */import"./main-BjVPLcVK.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./index.esm-Bla6j_hB.js";import"./WhatsAppModal-CqtV5vQS.js";/* empty css               */import"./server.browser-D0dT10Bs.js";class L extends P{constructor(){super(...arguments);j(this,"path","admin/services")}}const d=new L,V=({})=>{const n=p.useRef(),i=p.useRef(),c=p.useRef(),f=p.useRef(),x=p.useRef(),b=p.useRef(),[N,g]=p.useState(!1),[a,u]=p.useState([]),v=e=>{e!=null&&e.id?g(!0):g(!1),c.current.value=(e==null?void 0:e.id)??"",f.current.value=(e==null?void 0:e.name)??"",x.current.value=(e==null?void 0:e.description)??"",b.current.value=(e==null?void 0:e.price)??"";const t=(e==null?void 0:e.attributes)??[];u(t.length==0?[""]:t),$(i.current).modal("show")},S=async e=>{e.preventDefault();const t={id:c.current.value||void 0,name:f.current.value,price:b.current.value,description:x.current.value,attributes:a.filter(Boolean)};await d.save(t)&&($(n.current).dxDataGrid("instance").refresh(),$(i.current).modal("hide"))},T=async({id:e,value:t})=>{await d.boolean({id:e,field:"visible",value:t})&&$(n.current).dxDataGrid("instance").refresh()},C=async e=>{const{isConfirmed:t}=await O.fire({title:"Eliminar item",text:"¿Estás seguro de eliminar este item?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await d.delete(e)||$(n.current).dxDataGrid("instance").refresh()};return r.jsxs(r.Fragment,{children:[r.jsx(G,{gridRef:n,title:"Servicios",rest:d,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(n.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo registro",hint:"Nuevo registro",onClick:()=>v()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Nombre",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),y(e,r.jsxs("p",{className:"mb-0",style:{width:"100%"},children:[r.jsx("b",{className:"d-block",children:t.name}),r.jsx("small",{className:"text-wrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2},children:t.description})]}))}},{dataField:"price",caption:"Precio",dataType:"number",width:"100px",cellTemplate:(e,{data:t})=>{e.text(`S/.${Number(t.price).toFixed(2)}`)}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"120px",cellTemplate:(e,{data:t})=>{y(e,r.jsx(M,{checked:t.visible,onChange:s=>T({id:t.id,value:s.target.checked})}))}},{caption:"Acciones",width:"120px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(D({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>v(t)})),e.append(D({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>C(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsx(I,{modalRef:i,title:N?"Editar servicio":"Agregar servicio",onSubmit:S,size:"lg",onClose:()=>{u([]),console.log("Modal cerrado")},children:r.jsxs("div",{className:"row",id:"principal-container",children:[r.jsx("input",{ref:c,type:"hidden"}),r.jsxs("div",{className:"col-md-6",style:{height:"max-content"},children:[r.jsx(R,{eRef:f,label:"Nombre",required:!0}),r.jsx(q,{eRef:x,label:"Descripción",rows:3}),r.jsx(R,{eRef:b,label:"Precio",type:"number",step:.01,required:!0})]}),r.jsxs("div",{className:"col-md-6",style:{height:"max-content"},children:[r.jsxs("div",{className:"d-flex justify-content-between",children:[r.jsx("label",{htmlFor:"attributes-btn",className:"form-label",children:"Atributos"}),r.jsx(w,{content:"Agregar atributo",children:r.jsxs("span",{id:"attributes-btn",className:"cursor-pointer",onClick:()=>{u([...a,""]),setTimeout(()=>{var t;const e=document.querySelectorAll(".sortable-attributes .form-control");(t=e[e.length-1])==null||t.focus()},0)},children:[r.jsx("i",{className:"mdi mdi-plus me-1"}),"Agregar"]})})]}),r.jsx("div",{className:"sortable-attributes border p-2 rounded d-flex flex-column gap-1",style:{height:"calc(100% - 40px)",minHeight:"200px"},children:a.map((e,t)=>r.jsxs("div",{class:"input-group",draggable:!0,onDragStart:s=>s.dataTransfer.setData("index",t),onDragOver:s=>s.preventDefault(),onDrop:s=>{s.preventDefault();const m=parseInt(s.dataTransfer.getData("index")),o=t,l=[...a],[h]=l.splice(m,1);l.splice(o,0,h),u(l)},children:[r.jsx("span",{class:"input-group-text",style:{cursor:"grab"},children:r.jsx("i",{className:"fa fa-grip-vertical"})}),r.jsx("input",{type:"text",class:"form-control",placeholder:`Atributo ${t+1}`,value:e,onChange:s=>{const m=[...a];m[t]=s.target.value,u(m)},onKeyDown:s=>{if(s.key==="Enter"){s.preventDefault();const m=[...a,""];u(m),setTimeout(()=>{var l;const o=document.querySelectorAll(".sortable-attributes .form-control");(l=o[o.length-1])==null||l.focus()},0)}},onPaste:s=>{s.preventDefault();const o=s.clipboardData.getData("text").split(`
`).filter(h=>h.trim()),l=[...a];l[t]=o[0],o.length>1&&l.splice(t+1,0,...o.slice(1)),u(l)}}),r.jsx(w,{content:"Eliminar atributo",children:r.jsx("button",{className:"input-group-button btn btn-dark",type:"button",onClick:()=>{const s=a.filter((m,o)=>o!==t);u(s)},children:r.jsx("i",{className:"fa fa-times"})})})]},t))})]})]})})]})};F((n,i)=>{B(n).render(r.jsx(E,{...i,title:"Servicios",children:r.jsx(V,{...i})}))});
