var j=Object.defineProperty;var y=(i,s,r)=>s in i?j(i,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[s]=r;var m=(i,s,r)=>(y(i,typeof s!="symbol"?s+"":s,r),r);import{j as e}from"./AboutHeader-CpM0iYLI.js";import{r as n}from"./index-B80Lgev0.js";import{c as b}from"./ReactAppend-CBRQCQGz.js";import"./server.browser-D3N0_gce.js";import{C as F}from"./CreateReactScript-CL6ujVDa.js";import{B as N}from"./Base-CNDiEzgL.js";import{D as p,T as x}from"./DxPanelButton-BQ8_FDCw.js";import{R as l}from"./ReactAppend-C-tNgxIf.js";import{T as g,D as R}from"./Table-CJtAc2bi.js";import{S as T}from"./SendingHistoryRest-BFh50EsR.js";import{M as w}from"./Modal-DOqmO9Eq.js";import{B as k}from"./BasicRest-Dr9i-95X.js";import"./index-DO3Aws4m.js";import"./index.esm-Cu-mVv1q.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./main-B2CtU6ez.js";/* empty css               *//* empty css              */import"./tippy-react.esm-CHhA99mn.js";import"./Logout-CPQZ59pt.js";import"./WhatsAppModal-CjZ0YwJN.js";import"./sweetalert2.all-Dh0rZL5X.js";class C extends k{constructor(){super(...arguments);m(this,"path","admin/mailing/history-details");m(this,"hasFiles",!0)}}const u=new T,v=new C,D=()=>{const i=n.useRef(),s=n.useRef(),r=n.useRef();n.useRef(),n.useRef(),n.useRef(),n.useRef();const[d,c]=n.useState(!1),f=t=>{c(t),$(r.current).modal("show")},h=async t=>{await u.reSend(t)&&$(i.current).dxDataGrid("instance").refresh()};return e.jsxs(e.Fragment,{children:[e.jsx(g,{gridRef:i,title:e.jsx("h4",{className:"header-title my-0",children:"Historial de envios"}),rest:u,toolBar:t=>{t.unshift(p({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(i.current).dxDataGrid("instance").refresh()}))},pageSize:25,columns:[{dataField:"created_at",dataType:"datetime",caption:"Fecha",width:"180px",sortOrder:"desc",cellTemplate:(t,{data:a})=>{var o;t.text(moment((o=a.created_at)==null?void 0:o.replace("Z","+00:00")).format("lll"))}},{dataField:"type",caption:"Tipo",width:"120px",cellTemplate:(t,{value:a})=>{a=="WhatsApp"?l(t,e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-whatsapp me-1"}),a]})):l(t,e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-email me-1"}),a]}))}},{dataField:"name",caption:"Plantilla"},{dataField:"completed",caption:"Completados",dataType:"number",width:"80px",cssClass:"text-success font-bold"},{dataField:"failed",caption:"Fallidos",dataType:"number",width:"80px",cssClass:"text-danger font-bold"},{dataField:"total",caption:"Total",dataType:"number",width:"80px",cssClass:"text-primary font-bold"},{dataField:"status",caption:"Estado",dataType:"boolean",width:"140px",cellTemplate:(t,{data:a})=>{if(a.status===1&&l(t,e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-check me-1"}),e.jsx("span",{children:"Terminado"})]})),a.status===0&&l(t,e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-alert me-1"}),e.jsx("span",{children:"Fallido"})]})),a.status===null){const o=(a.completed+a.failed)/a.total*100;l(t,e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-spin mdi-autorenew me-1"}),e.jsx("span",{className:"me-1",children:"En curso"}),e.jsxs("small",{className:"text-muted",children:[o.toFixed(2),"%"]})]}))}},lookup:{dataSource:[{key:1,value:"Completado"},{key:0,value:"Enviando"},{key:null,value:"Pendiente"}],valueExpr:"key",displayExpr:"value"}},{caption:"Acciones",width:"130px",cellTemplate:(t,{data:a})=>{t.attr("style","display: flex; gap: 4px; overflow: unset"),a.status===0&&l(t,e.jsx(x,{className:"btn btn-xs btn-soft-primary",title:"Reintentar envio",onClick:()=>h(a.id),children:e.jsx("i",{className:"mdi mdi-reload"})})),a.status!==null&&l(t,e.jsx(x,{className:"btn btn-xs btn-soft-dark",title:"Ver detalles de envio",onClick:()=>f(a),children:e.jsx("i",{className:"mdi mdi-format-list-bulleted-type"})}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(w,{modalRef:r,title:e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"modal-title my-0",children:"Detalles de envío"}),e.jsx("small",{className:"text-muted",children:d==null?void 0:d.name})]}),size:"xl",onClose:()=>c(null),hideFooter:!0,children:e.jsx(R,{gridRef:s,rest:v,id:"grid-a",filterValue:["sending_history_id","=",(d==null?void 0:d.id)??null],toolBar:t=>{t.unshift(p({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(s.current).dxDataGrid("instance").refresh()}))},pageSize:25,allowQueryBuilder:!1,columns:[{dataField:"sending_history_id",caption:"ID Historial",visible:!1},{dataField:"sent_to",caption:"Destinatario"},{dataField:"seen",caption:"Visualización",dataType:"boolean",cellTemplate:(t,{data:a})=>{l(t,a.status?e.jsxs("span",{className:"text-primary font-bold",children:[e.jsx("i",{className:"mdi mdi-email-open me-1"}),"Abierto"]}):e.jsxs("span",{className:"text-muted",children:[e.jsx("i",{className:"mdi mdi-email me-1"}),"No abierto"]}))},width:"150px"},{dataField:"status",caption:"Estado",dataType:"boolean",cellTemplate:(t,{data:a})=>{l(t,a.status?e.jsxs("span",{className:"text-success font-bold",children:[e.jsx("i",{className:"mdi mdi-check me-1"}),"Enviado"]}):e.jsxs("span",{className:"text-danger font-bold",children:[e.jsx("i",{className:"mdi mdi-alert me-1"}),"No enviado"]}))},width:"150px"},{dataField:"error",caption:"Error",cssClass:"text-danger"},{dataField:"created_at",dataType:"datetime",caption:"Fecha",width:"200px",sortOrder:"desc",cellTemplate:(t,{data:a})=>{var o;l(t,e.jsx(e.Fragment,{children:moment((o=a.created_at)==null?void 0:o.replace("Z","+00:00")).format("lll")}))}}]})})]})};F((i,s)=>{b(i).render(e.jsx(N,{...s,title:"Historial de envios",children:e.jsx(D,{...s})}))});
