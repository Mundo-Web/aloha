var q=Object.defineProperty;var D=(o,l,c)=>l in o?q(o,l,{enumerable:!0,configurable:!0,writable:!0,value:c}):o[l]=c;var E=(o,l,c)=>(D(o,typeof l!="symbol"?l+"":l,c),c);import{m as b,C as I,c as O,R as t,r as u}from"./CreateReactScript-fryF6WsV.js";import{A as K,i as y}from"./Adminto-BXy2n_Qx.js";import{S as P}from"./SelectFormGroup-DgCpZP3V.js";import{B as Q}from"./BasicRest-4QHAt8VX.js";import{S as V}from"./sweetalert2.all-uggxmCrK.js";import{M as X}from"./Modal-BlYbLNMj.js";import{U as Y}from"./UsersRest-BKJrLo_s.js";import{U as Z}from"./UsersByServicesByBusinessesRest-cXNvIK4h.js";class L extends Q{constructor(){super(...arguments);E(this,"path","services-by-business");E(this,"byBusiness",async c=>{try{const{status:m,result:i}=await b.Fetch(`/api/${this.path}/${c}`);if(!m)throw new Error((i==null?void 0:i.message)||"Ocurrio un error al cargar los servicios vinculados a esta empresa");return i.data}catch(m){return console.error(m),null}});E(this,"enableService",async(c,m)=>{try{const{status:i,result:p}=await b.Fetch(`/api/${this.path}`,{method:"POST",body:JSON.stringify({business:c,service:m})});if(!i)throw new Error((p==null?void 0:p.message)||"Ocurrio un error al habilitar el servicio");return b.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:p.message,type:"success"}),p}catch(i){return b.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:i.message,type:"danger"}),null}})}}const ee=(o=[],l)=>{const c=[];return o.forEach((m,i)=>{i==0?c.push(m):c.push(l,m)}),c},te=new Y,C=new L,h=new Z,ae=({businesses:o=[],services:l=[],session:c,APP_DOMAIN:m})=>{var N,S,B;const i=u.useRef(),p=u.useRef(),w=u.useRef(),[v,F]=u.useState(b.GET.business),[U,G]=u.useState({}),[r,g]=u.useState(null),[T,z]=u.useState([]);u.useEffect(()=>{f()},[v]);const f=async()=>{const e=await C.byBusiness(v),n={};for(const s of e)n[s.service.correlative]=s;return G(n),n},x=({id:e,text:n,element:s})=>{if(!e)return;const a=JSON.parse($(s).attr("data")),d=document.createElement("div");return d.style.display="block",O(d).render(t.createElement(t.Fragment,null,t.createElement("div",{className:"relative d-flex align-items-center py-2"},t.createElement("div",{className:"flex-grow-1 overflow-hidden"},t.createElement("h5",{className:"mt-0 mb-1 text-truncate"},t.createElement("i",{className:"fa fa-building me-1"}),n),t.createElement("p",{className:"d-block text-gray mb-0 font-13 text-truncate"},a.owner.name," ",a.owner.lastname))))),d},J=e=>{const n=$(i.current).find("option:selected"),a=JSON.parse(n.attr("data")).person.document_number;history.pushState(null,null,`/services?business=${a}`),F(a)},j=async(e,n)=>{const{isConfirmed:s}=await V.fire({title:"¿Estás seguro?",text:"Habilitar el servicio puede aumentar los costos.",icon:"info",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});if(!s)return;e.target.disabled=!0;const a=await C.enableService(v,n);if(e.target.disabled=!1,!a)return;const d=await b.Fetch(`//${a.data.service}.${m}/api/start/${a.data.business}`);console.log(d),f()},H=async e=>{g(e),$(w.current).modal("show")},W=async()=>{var s,a;const e=[["email","contains",p.current.value]];(s=r==null?void 0:r.users)!=null&&s.length&&e.push("and",["!",ee((a=r==null?void 0:r.users)==null?void 0:a.map(({email:d})=>["email","=",d]),"or")]);const n=await te.paginate({filter:e});console.log(n),z((n==null?void 0:n.data)??[])},_=async e=>{const n=r.id;if(!await h.inviteUser(e,n))return;const a=await f();g(a[r.service.correlative])},A=async e=>{if(!await h.delete(e))return;const s=await f();g(s[r.service.correlative])},M=async({id:e,correlative:n})=>{await h.authorize({service:e,business:$(i.current).val()})&&window.open(`//${n}.${m}/home`)};return t.createElement(t.Fragment,null,t.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"calc(100vh - 135px)"}},t.createElement("div",null,t.createElement("div",{className:"mx-auto",style:{width:"240px"}},t.createElement(P,{eRef:i,templateResult:x,templateSelection:x,onChange:J},o.map((e,n)=>t.createElement("option",{key:`business-${n}`,value:e.id,data:JSON.stringify(e),selected:b.GET.business==e.person.document_number},e.name)))),t.createElement("hr",{className:"mx-auto",style:{width:"180px"}}),t.createElement("div",{className:"d-flex flex-wrap align-items-center justify-content-center gap-3"},l.map((e,n)=>{const s=U[e.correlative];return t.createElement("div",{key:`service-${n}`,className:"card mb-0",style:{width:"100%",maxWidth:"360px"}},t.createElement("div",{className:"card-body project-box"},t.createElement("div",{className:"badge bg-primary float-end"},"Gratis"),t.createElement("h4",{className:"mt-0"},t.createElement("a",{href:"#",className:"text-dark",onClick:()=>M(e)},e.name," ",t.createElement("i",{className:"mdi mdi-arrow-top-right"}))),t.createElement("p",{className:"text-success text-uppercase font-13"},e.correlative),t.createElement("p",{className:"text-muted font-13",style:{display:"-webkit-box",WebkitLineClamp:2,textOverflow:"ellipsis",WebkitBoxOrient:"vertical",overflow:"hidden",height:"38px"}},e.description),t.createElement("div",{className:"project-members mb-0"},s?t.createElement(t.Fragment,null,t.createElement("h5",{className:"float-start me-3"},"Equipo :"),t.createElement("div",{className:"avatar-group"},s.users.map((a,d)=>{var R,k;return t.createElement("div",{key:`user-${d}`,className:"avatar-group-item mb-0"},t.createElement(y,{content:`${((R=a==null?void 0:a.person)==null?void 0:R.name)||(a==null?void 0:a.name)} ${((k=a==null?void 0:a.person)==null?void 0:k.lastname)||(a==null?void 0:a.lastname)} ${c.id==a.id&&"(Tú)"}`},t.createElement("img",{src:`/api/profile/thumbnail/${a.relative_id}`,className:"rounded-circle avatar-sm",alt:`${a.name} ${a.lastname}`})))}),t.createElement("div",{className:"avatar-group-item mb-0",style:{cursor:"pointer"},onClick:()=>H(s)},t.createElement(y,{content:"Gestionar usuarios"},t.createElement("img",{src:"/assets/img/plus.svg",className:"rounded-circle avatar-sm",alt:"Gestionar usuarios",style:{backgroundColor:"rgba(255, 255, 255, .5)",border:"1px solid transparent"}}))))):t.createElement(y,{content:"Habilitar servicio"},t.createElement("button",{type:"button",className:"btn btn-sm btn-soft-primary rounded-pill waves-effect waves-light",onClick:a=>j(a,e.correlative)},t.createElement("i",{className:"mdi mdi-plus"})," Habilitar")))))})))),t.createElement(X,{modalRef:w,onSubmit:e=>e.preventDefault(),title:`Gestionar acceso a ${(N=r==null?void 0:r.service)==null?void 0:N.name}`,size:"md",isStatic:!0,hideFooter:!0},t.createElement("div",{className:"d-block btn-group mx-auto",style:{width:"max-content"}},t.createElement("button",{type:"button",className:"btn btn-secondary dropdown-toggle","data-bs-toggle":"dropdown","aria-expanded":"false"},t.createElement("i",{className:"fa fa-user-plus"})," Agregar usuarios a este servicio"),t.createElement("div",{className:"dropdown-menu dropdown-menu-center p-2",style:{width:"100%"}},t.createElement("input",{ref:p,className:"form-control mb-2",type:"text",onChange:W}),T.map((e,n)=>{var s,a;return t.createElement(t.Fragment,null,t.createElement("a",{key:`user-${n}`,className:"dropdown-item py-1 px-2 border-t",href:"#",onClick:()=>_(e.email)},t.createElement("p",{className:"mb-0 text-bold text-truncate"},((s=e==null?void 0:e.person)==null?void 0:s.name)||(e==null?void 0:e.name)," ",((a=e==null?void 0:e.person)==null?void 0:a.lastname)||(e==null?void 0:e.lastname)),t.createElement("p",{className:"mb-0 text-muted text-truncate",style:{fontSize:"small"}},e.email)))}))),t.createElement("hr",{className:"mx-auto",style:{maxWidth:"240px",width:"100%"}}),t.createElement("div",null,((S=r==null?void 0:r.users)==null?void 0:S.length)>0?t.createElement("table",{style:{width:"100%"}},t.createElement("tbody",null,(B=r==null?void 0:r.users)==null?void 0:B.map((e,n)=>{var s,a;return t.createElement("tr",{key:`user-${n}`},t.createElement("td",null,t.createElement("img",{src:`/api/profile/thumbnail/${e.relative_id}`,className:"rounded-circle avatar-sm me-1",alt:`${e.name} ${e.lastname}`})),t.createElement("td",null,t.createElement("div",null,t.createElement("h5",{className:"mt-1 mb-1 text-truncate"},((s=e==null?void 0:e.person)==null?void 0:s.name)||(e==null?void 0:e.name)," ",((a=e==null?void 0:e.person)==null?void 0:a.lastname)||(e==null?void 0:e.lastname)),t.createElement("p",{className:"mb-1 text-truncate",style:{fontSize:"small"}},e==null?void 0:e.email))),t.createElement("td",{align:"center"},e.pivot.invitation_accepted==!1&&t.createElement(y,{content:"El usuario no ha aceptado la invitacion"},t.createElement("p",{className:"mb-0 text-danger",style:{fontSize:"small"}},"Pendiente")),t.createElement("button",{className:"btn btn-xs btn-white rounded-pill",onClick:()=>A(e.pivot.id)},t.createElement("i",{className:"fa fa-trash"}))))}))):t.createElement("i",{className:"d-block text-center text-muted"},"- No hay usuarios vinculados -"))))};I((o,l)=>{O(o).render(t.createElement(K,{...l,title:"Servicios"},t.createElement(ae,{...l})))});
