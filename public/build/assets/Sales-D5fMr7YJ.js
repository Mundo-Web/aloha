var ee=Object.defineProperty;var te=(m,i,h)=>i in m?ee(m,i,{enumerable:!0,configurable:!0,writable:!0,value:h}):m[i]=h;var Y=(m,i,h)=>(te(m,typeof i!="symbol"?i+"":i,h),h);import{j as e}from"./AboutHeader-CpM0iYLI.js";import{B as ne}from"./Base-DUtpZS4_.js";import{i as P}from"./tippy-react.esm-CHhA99mn.js";import{r as N}from"./index-B80Lgev0.js";import{c as se}from"./ReactAppend-CBRQCQGz.js";import{S as H}from"./sweetalert2.all-Dh0rZL5X.js";import{m as K}from"./main-B2CtU6ez.js";import{B as re}from"./BasicRest-Dr9i-95X.js";import{S as X}from"./SalesRest-CMdeUyh_.js";import{M as ie}from"./Modal-B4tqXYU4.js";import{T as ce}from"./Table-CJtAc2bi.js";import{D as Q}from"./DxButton-CsjWvhyj.js";import{C as le,G as W}from"./CreateReactScript-DH4VP3S3.js";import{N as g}from"./Number2Currency-e57Tgsuk.js";import{R as U}from"./ReactAppend-C-tNgxIf.js";import{M as ae}from"./Modal-MO8_ThPe.js";import{S as V}from"./SelectFormGroup-DDkA9jve.js";import{r as L}from"./server.browser-D3N0_gce.js";import{I as _}from"./InputFormGroup-xtjt13oT.js";import{p as T}from"./places-DAXM8Qkz.js";import{T as Z}from"./TextareaFormGroup-BkvHoRll.js";import{C as oe}from"./CouponsRest-CF_zR6Xf.js";/* empty css              */import"./Logout-CPQZ59pt.js";import"./index.esm-Cu-mVv1q.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./WhatsAppModal-CjZ0YwJN.js";import"./index-DO3Aws4m.js";/* empty css               */class me extends re{constructor(){super(...arguments);Y(this,"path","admin/sale-statuses");Y(this,"bySale",async h=>{try{const{status:x,result:p}=await K.Fetch(`/api/${this.path}/by-sale/${h}`);if(!x)throw new Error((p==null?void 0:p.message)||"Ocurrio un error inesperado");return p.data}catch(x){return K.Notify.add({icon:"/assets/img/favicon.png",title:"Error",body:x.message,type:"danger"}),null}})}}const J=({name:m,formula:i,details:h})=>{var p,c,o,t,j,w,S,u,k,q,R,v;const x=h==null?void 0:h.filter(a=>!a.user_formula_id||a.user_formula_id==i.id);return e.jsxs(e.Fragment,{children:[i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("b",{children:"üßê Tratamiento"}),":"," ",(p=i==null?void 0:i.has_treatment)==null?void 0:p.description]}),e.jsxs("div",{children:[e.jsx("b",{children:"üëÄ Cuero cabelludo"}),": "," ",(c=i==null?void 0:i.scalp_type)==null?void 0:c.description]}),e.jsxs("div",{children:[e.jsx("b",{children:"‚úÖ Tipo de cabello"}),":"," ",(o=i==null?void 0:i.hair_type)==null?void 0:o.description]}),(i==null?void 0:i.hair_thickness)&&e.jsxs("div",{children:[e.jsx("b",{children:"üí™ Grosor del cabello"}),":"," ",(t=i==null?void 0:i.hair_thickness)==null?void 0:t.description]}),e.jsxs("div",{children:[e.jsx("b",{children:"üí° Objetivos"}),":"," ",e.jsx("ul",{className:"mb-0",children:(j=i==null?void 0:i.hair_goals_list)==null?void 0:j.map(a=>e.jsx("li",{children:a.description},a.id))})]}),e.jsxs("div",{children:[e.jsx("b",{children:"ü´ô Fragancia"}),":"," ",(w=i==null?void 0:i.fragrance)==null?void 0:w.name]})]}),e.jsxs("div",{children:[e.jsx("b",{children:"üé® Colores:"}),e.jsx("ul",{children:x==null?void 0:x.map((a,y)=>{var f,F;return e.jsxs("li",{children:[a.name,((f=a==null?void 0:a.colors)==null?void 0:f.length)>0&&e.jsxs(e.Fragment,{children:[": ",(F=a==null?void 0:a.colors)==null?void 0:F.map(A=>A.name).join(", ")]})]},y)})})]}),e.jsxs("button",{className:"btn btn-xs btn-dark",type:"button",copy:`${i?`*Formula ${m}*

üßê Tratamiento: ${(S=i==null?void 0:i.has_treatment)==null?void 0:S.description}
üëÄ Cuero cabelludo: ${(u=i==null?void 0:i.scalp_type)==null?void 0:u.description}
‚úÖ Tipo de cabello: ${(k=i==null?void 0:i.hair_type)==null?void 0:k.description}
${i!=null&&i.hair_thickness?`üí™ Grosor del cabello: ${(q=i==null?void 0:i.hair_thickness)==null?void 0:q.description}
`:""}üí° Objetivos:
${(R=i==null?void 0:i.hair_goals_list)==null?void 0:R.map(a=>`- ${a.description}`).join(`
`)}
ü´ô Fragancia: ${(v=i==null?void 0:i.fragrance)==null?void 0:v.name}
`:`*Pedido ${m}*

`}üé® Colores:
${x==null?void 0:x.map(a=>{var y,f;return`- ${a.name}${((y=a==null?void 0:a.colors)==null?void 0:y.length)>0?`: ${(f=a==null?void 0:a.colors)==null?void 0:f.map(F=>F.name).join(", ")}`:""}`}).join(`
`)}`,children:[e.jsx("i",{className:"mdi mdi-content-copy me-1"}),"Copiar"]})]})},de=new oe,he=new X,pe=({modalRef:m,gridRef:i,items:h,phone_prefixes:x=[],bundles:p})=>{m||(m=N.useRef());const[c,o]=N.useState({}),[t,j]=N.useState([]),[w,S]=N.useState(""),[u,k]=N.useState(null),q=s=>{const n=s.reduce((l,b)=>l+b.quantity,0);return p.find(l=>{switch(l.comparator){case"<":return n<l.items_quantity;case">":return n>l.items_quantity;default:return n==l.items_quantity}})},R=(s,n)=>{if(!s)return 0;const r=Number(s.amount)||0;return s.type=="fixed_amount"?r:s.type=="percentage"?(n-y)*r/100:0},v=t.reduce((s,n)=>s+n.price*n.quantity,0),a=q(t),y=v*((a==null?void 0:a.percentage)||0),f=R(u,v),F=v-y-f,A=(s,n)=>{const r=[...t],l=r[s];l.colors.push(n),l.quantity=l.colors.length,j(r)},I=(s,n)=>{const r=[...t],l=r[s];l.colors=l.colors.filter(b=>b.id!==n),l.quantity=l.colors.length,j(r)},M=(s,n)=>{const r=[...t],l=r[s];l.quantity=n,j(r)},O=async()=>{const s=await de.save({coupon:w,amount:v,email:c.email});k(s?s.data:null)},G=()=>{let s="Lima",n="Lima",r=null;return Array.isArray(T[c.department].items)?(s=T[c.department].name,n=c.province,r=null):(s=c.province,n=null,r=c.district),{...c,country:"Per√∫",department_code:c.department,department:s,province:n,district:r}},z=async s=>{s.preventDefault();const n={sale:{...G(),coupon:(u==null?void 0:u.name)||null},details:t};await he.pos(n)&&($(i.current).dxDataGrid("instance").refresh(),$(m.current).modal("hide"))},D=s=>{if(!s.id)return s.text;const n=s.element.dataset.code,r=s.element.dataset.flag,l=s.element.dataset.country,b=L(e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-emoji text-center",children:r}),e.jsx("b",{className:"ms-1",children:n}),e.jsx("small",{className:"d-block text-truncate",children:l})]}));return $(b)};return N.useEffect(()=>{$(m.current).on("shown.bs.modal",()=>{o({billing_type:"boleta",phone_prefix:"51"}),j(h.filter(({is_default:s})=>s).map(s=>({id:s.id,name:s.name,price:s.price,colors:[],quantity:0}))),S(""),k(null)})},[]),e.jsxs(ae,{id:"new-sale-modal",modalRef:m,title:"Nueva venta",size:"lg",isStatic:!0,hideFooter:!0,onSubmit:z,children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("h4",{className:"mt-0",children:"Informaci√≥n del cliente"}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{className:"form-label",children:["Tipo de comprobante ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col-6",children:e.jsx("label",{htmlFor:"billing_type_boleta",className:"card border mb-0",children:e.jsxs("div",{className:"card-body p-1 px-2 d-flex align-items-center  gap-1",children:[e.jsx("input",{type:"radio",className:"form-check-input",name:"billing_type",id:"billing_type_boleta",value:"boleta",style:{marginTop:"-2px"},checked:c.billing_type==="boleta",onChange:s=>o(n=>({...n,billing_type:s.target.value})),required:!0}),e.jsxs("span",{className:"d-flex align-items-center justify-content-center gap-1",htmlFor:"billing_type_boleta",children:[e.jsx("i",{className:"mdi mdi-account font-18"}),e.jsx("span",{children:"Boleta"})]})]})})}),e.jsx("div",{className:"col-6",children:e.jsx("label",{htmlFor:"billing_type_factura",className:"card border mb-0",children:e.jsxs("div",{className:"card-body p-1 px-2 d-flex align-items-center gap-1",children:[e.jsx("input",{type:"radio",className:"form-check-input",name:"billing_type",id:"billing_type_factura",value:"factura",style:{marginTop:"-2px"},checked:c.billing_type==="factura",onChange:s=>o(n=>({...n,billing_type:s.target.value})),required:!0}),e.jsxs("span",{className:"d-flex align-items-center justify-content-center gap-1",htmlFor:"billing_type_factura",children:[e.jsx("i",{className:"mdi mdi-office-building font-18"}),e.jsx("span",{children:"Factura"})]})]})})})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{className:"form-label",htmlFor:"billing_number",children:["Documento ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"billing_number",className:"form-control",value:c.billing_number||"",maxLength:c.billing_type==="boleta"?8:11,minLength:c.billing_type==="boleta"?8:11,required:!0,onChange:s=>{const n=s.target.value.replace(/\D/g,"");o(r=>({...r,billing_number:n}))}})]}),e.jsxs("div",{className:"row",children:[e.jsx(_,{label:"Nombres",col:"col-md-6",value:c.name,onChange:s=>o(n=>({...n,name:s.target.value})),required:!0}),e.jsx(_,{label:"Apellidos",col:"col-md-6",value:c.lastname,onChange:s=>o(n=>({...n,lastname:s.target.value})),required:!0})]}),e.jsx(_,{label:"Email",type:"email",value:c.email,onChange:s=>o(n=>({...n,email:s.target.value})),required:!0}),e.jsx("label",{htmlFor:"",className:"form-label",children:"Celular"}),e.jsxs("div",{className:"row",children:[e.jsx(V,{col:"col-md-4",dropdownParent:"#new-sale-modal",minimumInputLength:-1,templateResult:D,templateSelection:D,value:c.phone_prefix,onChange:s=>o(n=>({...n,phone_prefix:s.target.value})),children:x.sort((s,n)=>s.country.localeCompare(n.country)).map((s,n)=>e.jsxs("option",{value:s.realCode,"data-code":s.beautyCode,"data-flag":s.flag,"data-country":s.country,children:[s.beautyCode," ",s.country]},n))}),e.jsx(_,{col:"col-md-8",type:"tel",value:c.phone,onChange:s=>{const n=s.target.value.replace(/\D/g,"");o(r=>({...r,phone:n}))}})]}),e.jsx("div",{className:"mb-2",children:e.jsxs(V,{label:"Origen de venta",minimumResultsForSearch:-1,dropdownParent:"#new-sale-modal",value:c.origin,onChange:s=>o(n=>({...n,origin:s.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Elige una opci√≥n"}),e.jsx("option",{value:"Banner",children:"Banner publicitario"}),e.jsx("option",{value:"Facebook",children:"Facebook"}),e.jsx("option",{value:"Instagram",children:"Instagram"}),e.jsx("option",{value:"WhatsApp",children:"WhatsApp"}),e.jsx("option",{value:"TikTok",children:"TikTok"})]})}),e.jsx(Z,{label:"Comentario interno",value:c.origin_comment,onChange:s=>o(n=>({...n,origin_comment:s.target.value})),placeholder:"Ingresa un comentario sobre por qu√© se est√° creando esta venta..."})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("h4",{className:"mt-0",children:"Direcci√≥n del cliente"}),e.jsx(_,{label:"Pais",value:"Per√∫",disabled:!0,required:!0}),e.jsxs(V,{label:"Regi√≥n / Provincia",value:c.department||"",onChange:s=>o(n=>({...n,department:s.target.value})),minimumResultsForSearch:-1,dropdownParent:"#new-sale-modal",required:!0,children:[e.jsx("option",{value:"",children:"Elige una opci√≥n"}),Object.keys(T).map((s,n)=>e.jsx("option",{value:s,children:T[s].name},n))]}),T[c.department]&&e.jsxs("div",{className:"row",children:[Array.isArray(T[c.department].items)?e.jsxs(V,{label:"Provincia",col:"col-md-8",dropdownParent:"#new-sale-modal",value:c.province,effectWith:[c.department],onChange:s=>o(n=>({...n,province:s.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Elige una opci√≥n"}),T[c.department].items.map((s,n)=>e.jsx("option",{value:s,children:s},n))]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{label:"Departamento",col:"col-md-4",value:c.province,onChange:s=>o(n=>({...n,province:s.target.value})),required:!0}),e.jsx(_,{label:"Distrito",col:"col-md-4",value:c.district,onChange:s=>o(n=>({...n,district:s.target.value})),required:!0})]}),e.jsx(_,{label:"C√≥d. Postal",col:"col-md-4",value:c.zip_code,onChange:s=>o(n=>({...n,zip_code:s.target.value}))})]}),e.jsxs("div",{className:"row",children:[e.jsx(_,{label:"Direcci√≥n",col:"col-md-8",value:c.address,onChange:s=>o(n=>({...n,address:s.target.value})),required:!0}),e.jsx(_,{label:"N√∫mero",col:"col-md-4",type:"number",value:c.number,onChange:s=>o(n=>({...n,number:s.target.value})),required:!0})]}),e.jsx(_,{label:"Apartamento, habitaci√≥n, piso, etc.",value:c.reference,onChange:s=>o(n=>({...n,reference:s.target.value}))}),e.jsx(Z,{label:"Notas del pedido",value:c.comment,placeholder:"Notas sobre el pedido, por ejemplo, notas especiales para la entrega.",onChange:s=>o(n=>({...n,comment:s.target.value}))})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"mb-0",children:"Productos"}),e.jsx("small",{className:"text-muted",children:"Selecciona los productos que deseas agregar a la compra"})]}),e.jsx("div",{className:"product-selection mb-1",children:e.jsx("div",{className:"row",children:h.map(s=>{const n=t.some(r=>r.id===s.id);return e.jsx("div",{className:"col-sm-6 col-md-3 mb-2",children:e.jsx("div",{className:`card mb-0 h-100 cursor-pointer shadow-lg ${n?"border border-primary":""}`,onClick:()=>{if(!n)j([...t,{id:s.id,name:s.name,price:s.price,colors:[],quantity:0}]);else{const r=[...t];r.splice(r.findIndex(l=>l.id===s.id),1),j(r)}},children:e.jsxs("div",{className:"card-body p-2",children:[e.jsx("h5",{className:`card-title mt-0 mb-0 ${n?"text-primary":""}`,children:s.name}),e.jsxs("small",{className:"card-text text-muted",children:["S/ ",s.price||79.9]})]})})},s.id)})})}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-centered table-nowrap table-bordered table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Color"}),e.jsx("th",{style:{width:"92px"},children:"Cant."}),e.jsx("th",{style:{width:"88px"},children:"Precio"}),e.jsx("th",{style:{width:"88px"},children:"Subtotal"})]})}),e.jsx("tbody",{children:t.map((s,n)=>{var b;const r=h.find(d=>d.id===s.id),l=(r==null?void 0:r.colors)||[];return(b=s.colors)==null||b.length,e.jsxs("tr",{children:[e.jsx("td",{children:(r==null?void 0:r.name)||"Producto no encontrado"}),e.jsx("td",{style:{width:"240px"},children:e.jsx("div",{className:"d-flex flex-wrap gap-1",children:l.map(d=>{const C=s.colors.filter(B=>B.id===d.id).length;return e.jsx(P,{content:d.name,children:e.jsxs("div",{onClick:()=>A(n,d),className:"position-relative cursor-pointer",children:[e.jsx("div",{className:`rounded-circle position-relative p-2 border ${C>0?"border-primary":""}`,style:{backgroundColor:d.hex}}),C>0&&e.jsx("small",{className:"position-absolute translate-middle badge rounded-pill bg-primary",onClick:B=>{B.stopPropagation(),I(n,d.id)},style:{padding:"2px 4px",top:"4px",fontSize:"10px",right:"-12px"},children:C})]})},d.id)})})}),e.jsx("td",{children:l.length==0?e.jsx("input",{className:"form-control form-control-sm",type:"number",style:{width:"75px"},value:s.quantity,onChange:d=>M(n,d.target.value)}):s.quantity}),e.jsxs("td",{className:"text-end",children:["S/ ",s.price]}),e.jsxs("td",{className:"text-end",children:["S/ ",(s.price*s.quantity).toFixed(2)]})]},n)})}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end",children:"Subtotal:"}),e.jsxs("td",{className:"text-end",children:["S/ ",v.toFixed(2)]})]}),a&&e.jsxs("tr",{children:[e.jsxs("td",{colSpan:4,className:"text-end",children:[e.jsx("span",{className:"d-block",children:"Descuento por paquete"}),e.jsxs("small",{className:"text-muted -mt-1",children:["Escogiste un ",a.name," (",(a.percentage*100).toFixed(2),"%)"]})]}),e.jsxs("td",{className:"text-end",children:["S/ -",g(Math.round(y*10)/10)]})]}),u&&e.jsxs("tr",{children:[e.jsxs("td",{colSpan:4,className:"text-end",children:[e.jsxs("span",{className:"d-block",children:["Cup√≥n aplicado",e.jsx(P,{content:"Eliminar",children:e.jsx("i",{className:"text-danger mdi mdi-close cursor-pointer ms-1",onClick:()=>k(null)})})]}),e.jsxs("small",{className:"text-muted",children:[u.name," (",u.type=="fixed_amount"?`S/ -${g(u.amount)}`:`-${Math.round(u.amount*100)/100}%`,")"]})]}),e.jsxs("td",{className:"text-end",children:["S/ -",g(Math.round(f*10)/10)]})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end",children:"Total:"}),e.jsxs("td",{className:"text-end",children:["S/ ",g(Math.round(F*10)/10)]})]})]})]})})]})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:!u&&e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"C√≥digo de cup√≥n",value:w,onChange:s=>S(s.target.value)}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:O,children:"Aplicar cup√≥n"})]})}),e.jsx("div",{className:"col-md-6 text-end",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Guardar venta"})})]})]})},E=new X,ue=new me,xe=({statuses:m,items:i,phone_prefixes:h,bundles:x})=>{var y,f,F,A,I,M,O,G,z,D,s;const p=N.useRef(),c=N.useRef(),o=N.useRef(),[t,j]=N.useState(null),[w,S]=N.useState([]),u=async n=>{const r=n.target.value,l=$(n.target).find(`option[value="${r}"]`);if(l.data("confirm")){const{isConfirmed:C}=await H.fire({title:"Actualizar estado",text:`¬øEst√°s seguro de actualizar la venta al estado "${l.text()}"?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Si, actualizar",cancelButtonText:"Cancelar"});if(!C)return}const d=await E.save({id:t.id,status_id:r});d&&(j(d.data),$(p.current).dxDataGrid("instance").refresh())},k=async n=>{const r=n.target.value,l=await E.save({id:t.id,courier:r});l&&(j(l.data),$(p.current).dxDataGrid("instance").refresh())},q=async n=>{const r=$("#courierAmountInput").val(),l=await E.save({id:t.id,courier_amount:r});l&&(j(l.data),$(p.current).dxDataGrid("instance").refresh())},R=async n=>{const{isConfirmed:r}=await H.fire({title:"Anular pedido",text:"¬øEstas seguro de anular este pedido?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, anular",cancelButtonText:"Cancelar"});!r||await E.delete(n)},v=async n=>{S([]);const r=await E.get(n);j(r),$(c.current).modal("show")};N.useEffect(()=>{t&&(ue.bySale(t.id).then(n=>{S(n||[])}),$("#courierAmountInput").val(t==null?void 0:t.courier_amount))},[t]),Number(t==null?void 0:t.amount)+Number(t==null?void 0:t.delivery)-Number(t==null?void 0:t.bundle_discount)-Number(t==null?void 0:t.renewal_discount)-Number(t==null?void 0:t.coupon_discount);const a=t!=null&&t.phone.clean("0-9").startsWith("51")?t==null?void 0:t.phone.clean("0-9"):`51${t==null?void 0:t.phone.clean("0-9")}`;return e.jsxs(e.Fragment,{children:[e.jsx(ce,{gridRef:p,title:"Pedidos",rest:E,toolBar:n=>{n.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(p.current).dxDataGrid("instance").refresh()}}),n.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"Agrega una venta manual",text:"Nueva venta",onClick:()=>$(o.current).modal("show")}})},exportable:!0,pageSize:25,columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"code",caption:"Numero de orden",visible:!1},{dataField:"created_at",caption:"Fecha",dataType:"date",sortOrder:"desc",width:"150px",cellTemplate:(n,{data:r})=>{n.css("cursor","pointer"),n.on("click",()=>{v(r.id)}),U(n,e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"d-block",children:moment(r.created_at.replace("Z","-05:00")).fromNow()}),e.jsx("small",{className:"d-block text-muted",children:moment(r.created_at).format("lll")})]}))}},{dataField:"fullname",caption:"Orden",width:"250px",cellTemplate:(n,{data:r})=>{n.css("cursor","pointer"),n.on("click",()=>{v(r.id)}),U(n,e.jsxs("p",{className:"mb-0",style:{width:"100%"},children:[e.jsxs("b",{className:"d-block w-100 text-truncate",children:[r.renewal&&e.jsx(P,{content:`Plan: ${r.renewal.name}`,children:e.jsx("i",{className:"fa fas fa-spa text-pink me-1"})}),r.name," ",r.lastname]}),e.jsxs("small",{className:"text-nowrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,fontFamily:"monospace"},children:["#",W.APP_CORRELATIVE,"-",r.code]})]}))}},{dataField:"status.name",caption:"Estado",width:"100px",cellTemplate:(n,{data:r})=>{U(n,e.jsx(e.Fragment,{children:e.jsx(P,{content:r.status.description,children:e.jsx("span",{className:"d-block mx-auto badge rounded-pill",style:{backgroundColor:r.status.color?`${r.status.color}2e`:"#3333332e",color:r.status.color??"#333",width:"max-content",marginBottom:"4px"},children:r.status.name})})}))}},{dataField:"total_amount",caption:"Total",dataType:"number",width:"100px",cellTemplate:(n,{data:r})=>{n.text(`S/. ${g(r.total_amount)}`)}},{dataField:"phone",caption:"Tel√©fono",width:"120px",cellTemplate:(n,{data:r})=>{n.text(r.phone.keep("0-9"))}},{dataField:"email",caption:"Email"},{dataField:"department",caption:"Departamento"},{dataField:"province",caption:"Ciudad",cellTemplate:(n,{data:r})=>{n.text(r.province||r.district)}},{dataField:"courier",caption:"Enviado por",width:"100px",cellTemplate:(n,{data:r})=>{n.html(L(e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"d-block",children:r.courier}),r.courier_amount&&e.jsxs("small",{className:"text-muted",children:["S/. ",g(r.courier_amount)]})]})))}},{dataField:"origin",caption:"Origen"},{caption:"Acciones",cellTemplate:(n,{data:r})=>{n.append(Q({className:"btn btn-xs btn-light",title:"Ver pedido",icon:"fa fa-eye",onClick:()=>v(r.id)})),!r.status.confirm&&n.append(Q({className:"btn btn-xs btn-soft-danger",title:"Anular pedido",icon:"fa fa-trash",onClick:()=>R(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(ie,{modalRef:c,title:`Detalles del pedido #${W.APP_CORRELATIVE}-${t==null?void 0:t.code}`,size:"xl",bodyStyle:{backgroundColor:"#ebeff2"},hideButtonSubmit:!0,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Detalles de Venta"})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsx("table",{id:"table-info",className:"table table-borderless table-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Nombres:"}),e.jsxs("td",{children:[t==null?void 0:t.name," ",t==null?void 0:t.lastname]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Email:"}),e.jsx("td",{children:t==null?void 0:t.email})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Tel√©fono:"}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-1 align-items-center",children:[e.jsx("img",{className:"avatar-sm rounded-circle",src:`${W.WA_URL}/api/profile/${W.APP_CORRELATIVE}/${a}`,onError:n=>{n.target.onerror=null,n.target.src="/api/admin/profile/thumbnail/undefined"},alt:(t==null?void 0:t.name)+" "+(t==null?void 0:t.lastname)}),e.jsxs("div",{children:[e.jsx("span",{className:"d-block",children:t==null?void 0:t.phone}),e.jsx("a",{href:`//wa.me/${a}`,target:"_blank",children:e.jsxs("small",{children:["Abrir WhatsApp ",e.jsx("i",{className:"mdi mdi-arrow-top-right"})]})})]})]})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Direcci√≥n:"}),e.jsxs("td",{children:[t==null?void 0:t.address," ",t==null?void 0:t.number,e.jsxs("small",{className:"text-muted d-block",children:[(t==null?void 0:t.province)??(t==null?void 0:t.district),", ",t==null?void 0:t.department,", ",t==null?void 0:t.country," ",(t==null?void 0:t.zip_code)&&e.jsxs(e.Fragment,{children:["- ",t==null?void 0:t.zip_code]})]})]})]}),(t==null?void 0:t.reference)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Referencia:"}),e.jsx("td",{children:t==null?void 0:t.reference})]}),(t==null?void 0:t.comment)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Comentario:"}),e.jsx("td",{children:t==null?void 0:t.comment})]}),(t==null?void 0:t.billing_type)&&(t==null?void 0:t.billing_number)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Comprobante:"}),e.jsxs("td",{children:[e.jsx("b",{className:"d-block",children:t.billing_type.toTitleCase()}),e.jsxs("small",{children:[e.jsx("code",{className:"me-1",children:t.billing_type=="boleta"?"DNI":"RUC"}),e.jsx("span",{children:t==null?void 0:t.billing_number})]})]})]})]})}),e.jsxs("button",{className:"btn btn-xs btn-dark",type:"button",copy:`Nombres: ${t==null?void 0:t.fullname}
Email: ${t==null?void 0:t.email}
Tel√©fono: ${t==null?void 0:t.phone}
Direcci√≥n: ${t==null?void 0:t.address} ${t==null?void 0:t.number}${t!=null&&t.zip_code?`
C√≥digo Postal: ${t==null?void 0:t.zip_code}`:""}
Ubicaci√≥n: ${(t==null?void 0:t.province)??(t==null?void 0:t.district)}, ${t==null?void 0:t.department}, ${t==null?void 0:t.country}${t!=null&&t.reference?`
Referencia: ${t==null?void 0:t.reference}`:""}${t!=null&&t.comment?`
Comentario: ${t==null?void 0:t.comment}`:""}${t!=null&&t.billing_type&&(t!=null&&t.billing_number)?`
Comprobante: ${t.billing_type.toTitleCase()}
${t.billing_type=="boleta"?"DNI":"RUC"}: ${t==null?void 0:t.billing_number}`:""}`,children:[e.jsx("i",{className:"mdi mdi-content-copy me-1"}),"Copiar"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Art√≠culos"})}),e.jsx("div",{className:"card-body p-2 table-responsive",children:e.jsxs("table",{className:"table table-striped table-bordered table-sm table-hover mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Colores"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Subtotal"})]})}),e.jsx("tbody",{children:(y=t==null?void 0:t.details)==null?void 0:y.map((n,r)=>{var d;const l=n.quantity*100/100,b=n.price*n.quantity;return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("span",{className:"d-block",children:n.name}),n.user_formula_id&&n.user_formula_id!=t.user_formula_id&&e.jsx(P,{content:e.jsx(J,{name:t==null?void 0:t.name,details:t==null?void 0:t.details,formula:n.user_formula}),allowHTML:!0,interactive:!0,children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"mdi mdi-flask me-1"}),"F√≥rmula secundaria"]})})]}),e.jsx("td",{children:(d=n==null?void 0:n.colors)==null?void 0:d.map((C,B)=>e.jsx(P,{content:C.name,children:e.jsx("i",{className:"mdi mdi-circle",style:{color:C.hex,WebkitTextStroke:"1px #808080"}})},B))}),e.jsxs("td",{align:"right",children:["S/ ",g(n.price)]}),e.jsx("td",{align:"center",children:l}),e.jsxs("td",{align:"right",children:["S/ ",g(b)]})]},r)})})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Resumen"})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Subtotal:"}),e.jsxs("span",{children:["S/ ",g(t==null?void 0:t.amount)]})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Env√≠o:"}),e.jsx("span",{children:(t==null?void 0:t.delivery)===null?"Pago en destino":e.jsxs(e.Fragment,{children:["S/ ",g(t==null?void 0:t.delivery)]})})]}),(t==null?void 0:t.bundle)&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("b",{children:["Descuento x paquete:",e.jsxs("small",{className:"d-block text-muted",style:{fontWeight:"lighter"},children:["Elegiste ",(f=t==null?void 0:t.bundle)==null?void 0:f.name," (-",((F=t==null?void 0:t.bundle)==null?void 0:F.percentage)*1e4/100,"%)"]})]}),e.jsxs("span",{children:["S/ -",g(t==null?void 0:t.bundle_discount)]})]}),(t==null?void 0:t.renewal)&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("b",{children:["Subscripci√≥n:",e.jsxs("small",{className:"d-block text-muted",style:{fontWeight:"lighter"},children:[(A=t==null?void 0:t.renewal)==null?void 0:A.name," (-",((I=t==null?void 0:t.renewal)==null?void 0:I.percentage)*1e4/100,"%)"]})]}),e.jsxs("span",{children:["S/ -",g(t==null?void 0:t.renewal_discount)]})]}),(t==null?void 0:t.coupon)&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("b",{children:["Cup√≥n aplicado:",e.jsxs("small",{className:"d-block text-muted",style:{fontWeight:"lighter"},children:[(M=t==null?void 0:t.coupon)==null?void 0:M.name," (-",((O=t==null?void 0:t.coupon)==null?void 0:O.amount)*100/100,"%)"]})]}),e.jsxs("span",{children:["S/ -",g(t==null?void 0:t.coupon_discount)]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Total:"}),e.jsx("span",{children:e.jsxs("strong",{children:["S/ ",g(t==null?void 0:t.total_amount)]})})]})]})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Formula principal"})}),e.jsx("div",{className:"card-body p-2",children:e.jsx(J,{name:t==null?void 0:t.name,details:t==null?void 0:t.details,formula:t==null?void 0:t.formula})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Estado"})}),e.jsx("div",{className:"card-body p-2",children:e.jsxs("div",{className:"",children:[e.jsx("label",{htmlFor:"statusSelect",className:"form-label",children:"Estado Actual"}),e.jsx("select",{className:"form-select",id:"statusSelect",value:t==null?void 0:t.status_id,onChange:u,disabled:!((G=t==null?void 0:t.status)!=null&&G.reversible),children:m.map((n,r)=>e.jsx("option",{value:n.id,"data-confirm":!!n.confirm,children:n.name},r))})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Enviado por"})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsxs("div",{className:"form-group mb-2",children:[e.jsx("label",{htmlFor:"courierSelect",className:"form-label",children:"Agencia de env√≠o"}),e.jsxs("select",{className:"form-select",id:"courierSelect",value:(t==null?void 0:t.courier)??"",onChange:k,disabled:!((z=t==null?void 0:t.status)!=null&&z.reversible),children:[e.jsx("option",{value:"",children:"- Selecciona -"}),e.jsx("option",{value:"Kamary",children:"Kamary"}),e.jsx("option",{value:"Olva",children:"Olva"}),e.jsx("option",{value:"Shalom",children:"Shalom"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"courierAmountInput",className:"form-label",children:"Costo de env√≠o"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"number",className:"form-control",id:"courierAmountInput",step:.01,defaultValue:0,disabled:!((D=t==null?void 0:t.status)!=null&&D.reversible)}),e.jsx("button",{className:"btn btn-success btn-sm",disabled:!((s=t==null?void 0:t.status)!=null&&s.reversible),type:"button",onClick:()=>q(),children:"Guardar"})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Cambios de Estado"})}),e.jsx("div",{className:"card-body p-2 d-flex flex-column gap-1",style:{maxHeight:"300px",overflowY:"auto"},children:w==null?void 0:w.map((n,r)=>{var b,d,C;const l=`${((b=n.user)==null?void 0:b.name)||""} ${((d=n.user)==null?void 0:d.lastname)||""}`.trim()||"Autom√°tico";return e.jsxs("article",{className:"border py-1 px-2 ms-3",style:{position:"relative",borderRadius:"16px 4px 4px 16px",backgroundColor:n.status.color?`${n.status.color}2e`:"#3333332e"},children:[e.jsx("i",{className:"mdi mdi-circle left-2",style:{color:n.status.color||"#333",position:"absolute",left:"-25px",top:"50%",transform:"translateY(-50%)"}}),e.jsx("b",{style:{color:n.status.color||"#333"},children:(C=n==null?void 0:n.status)==null?void 0:C.name}),e.jsx("small",{className:"d-block text-truncate",children:l}),e.jsx("small",{className:"d-block text-muted",children:moment(n.created_at).format("YYYY-MM-DD HH:mm")})]},r)})})]})]})]})}),e.jsx(pe,{modalRef:o,gridRef:p,items:i,phone_prefixes:h,bundles:x})]})};le((m,i)=>{se(m).render(e.jsx(ne,{...i,title:"Pedidos",children:e.jsx(xe,{...i})}))});
